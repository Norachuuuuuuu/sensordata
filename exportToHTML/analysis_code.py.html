<html>
<head>
<title>analysis_code.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #7a7e85;}
.s4 { color: #6aab73;}
.s5 { color: #5f826b; font-style: italic;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
analysis_code.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">os</span>
<span class="s0">import </span><span class="s1">glob</span>
<span class="s0">import </span><span class="s1">json</span>
<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">scipy </span><span class="s0">import </span><span class="s1">stats</span>
<span class="s0">import </span><span class="s1">statsmodels</span><span class="s2">.</span><span class="s1">api </span><span class="s0">as </span><span class="s1">sm</span>
<span class="s0">from </span><span class="s1">statsmodels</span><span class="s2">.</span><span class="s1">formula</span><span class="s2">.</span><span class="s1">api </span><span class="s0">import </span><span class="s1">ols</span><span class="s2">, </span><span class="s1">mixedlm</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">import </span><span class="s1">seaborn </span><span class="s0">as </span><span class="s1">sns</span>
<span class="s0">from </span><span class="s1">uuid </span><span class="s0">import </span><span class="s1">uuid4</span>

<span class="s3"># Define balance parameters - keeping the original parameters from your code</span>
<span class="s1">itug_params </span><span class="s2">= [</span><span class="s4">'PC1_std'</span><span class="s2">, </span><span class="s4">'PC1_range'</span><span class="s2">, </span><span class="s4">'PC1_mean'</span><span class="s2">, </span><span class="s4">'PC2_std'</span><span class="s2">, </span><span class="s4">'PC2_range'</span><span class="s2">, </span><span class="s4">'PC2_mean'</span><span class="s2">]</span>
<span class="s1">isway_params </span><span class="s2">= [</span><span class="s4">'PC1_std'</span><span class="s2">, </span><span class="s4">'PC1_range'</span><span class="s2">, </span><span class="s4">'PC1_mean'</span><span class="s2">, </span><span class="s4">'mean_distance'</span><span class="s2">, </span><span class="s4">'sway_area'</span><span class="s2">]</span>


<span class="s0">def </span><span class="s1">load_data</span><span class="s2">(</span><span class="s1">base_dir</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot; 
    Load participant data from participant_summary.json files. 
 
    Args: 
        base_dir: The base directory containing the sensor_analysis folder 
 
    Returns: 
        DataFrame: Containing all participant data 
    &quot;&quot;&quot;</span>
    <span class="s1">sensor_dir </span><span class="s2">= </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">base_dir</span><span class="s2">, </span><span class="s4">&quot;sensor_analysis&quot;</span><span class="s2">)</span>
    <span class="s1">df_list </span><span class="s2">= []</span>

    <span class="s3"># Find all participant directories (format: Name-Gender-Age-Weight-Height)</span>
    <span class="s1">participant_dirs </span><span class="s2">= </span><span class="s1">glob</span><span class="s2">.</span><span class="s1">glob</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">sensor_dir</span><span class="s2">, </span><span class="s4">&quot;*-[EK]-*-*-*&quot;</span><span class="s2">))</span>

    <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Found </span><span class="s0">{</span><span class="s1">len</span><span class="s2">(</span><span class="s1">participant_dirs</span><span class="s2">)</span><span class="s0">} </span><span class="s4">participant directories&quot;</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">participant_dir </span><span class="s0">in </span><span class="s1">participant_dirs</span><span class="s2">:</span>
        <span class="s1">participant_name </span><span class="s2">= </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">basename</span><span class="s2">(</span><span class="s1">participant_dir</span><span class="s2">)</span>
        <span class="s1">participant_summary_path </span><span class="s2">= </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">participant_dir</span><span class="s2">, </span><span class="s4">'participant_summary.json'</span><span class="s2">)</span>

        <span class="s0">if not </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">exists</span><span class="s2">(</span><span class="s1">participant_summary_path</span><span class="s2">):</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Warning: Missing participant summary file for </span><span class="s0">{</span><span class="s1">participant_name</span><span class="s0">}</span><span class="s4">. Skipping.&quot;</span><span class="s2">)</span>
            <span class="s0">continue</span>

        <span class="s0">try</span><span class="s2">:</span>
            <span class="s0">with </span><span class="s1">open</span><span class="s2">(</span><span class="s1">participant_summary_path</span><span class="s2">, </span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">encoding</span><span class="s2">=</span><span class="s4">'utf-8'</span><span class="s2">) </span><span class="s0">as </span><span class="s1">f</span><span class="s2">:</span>
                <span class="s1">participant_data </span><span class="s2">= </span><span class="s1">json</span><span class="s2">.</span><span class="s1">load</span><span class="s2">(</span><span class="s1">f</span><span class="s2">)</span>

            <span class="s3"># Extract demographic data</span>
            <span class="s1">person_df </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">({</span>
                <span class="s4">'name'</span><span class="s2">: [</span><span class="s1">participant_data</span><span class="s2">[</span><span class="s4">'name'</span><span class="s2">]],</span>
                <span class="s4">'gender'</span><span class="s2">: [</span><span class="s1">participant_data</span><span class="s2">[</span><span class="s4">'gender'</span><span class="s2">]],</span>
                <span class="s4">'age'</span><span class="s2">: [</span><span class="s1">participant_data</span><span class="s2">[</span><span class="s4">'age'</span><span class="s2">]],</span>
                <span class="s4">'weight'</span><span class="s2">: [</span><span class="s1">participant_data</span><span class="s2">[</span><span class="s4">'weight'</span><span class="s2">]],</span>
                <span class="s4">'height'</span><span class="s2">: [</span><span class="s1">participant_data</span><span class="s2">[</span><span class="s4">'height'</span><span class="s2">]],</span>
                <span class="s4">'bmi'</span><span class="s2">: [</span><span class="s1">participant_data</span><span class="s2">[</span><span class="s4">'bmi'</span><span class="s2">]]</span>
            <span class="s2">})</span>

            <span class="s3"># Process pre-ITUG metrics</span>
            <span class="s1">pre_itug </span><span class="s2">= </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'pre_itug_metrics'</span><span class="s2">, {})</span>
            <span class="s0">if </span><span class="s1">pre_itug </span><span class="s0">and </span><span class="s1">pre_itug</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'valid'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">):</span>
                <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">itug_params</span><span class="s2">:</span>
                    <span class="s3"># Handle PC2 parameters which might not be in the original data</span>
                    <span class="s0">if </span><span class="s1">param</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s4">'PC2'</span><span class="s2">) </span><span class="s0">and </span><span class="s1">param </span><span class="s0">not in </span><span class="s1">pre_itug</span><span class="s2">:</span>
                        <span class="s1">person_df</span><span class="s2">[</span><span class="s4">f'pre_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">] = </span><span class="s6">0</span>
                        <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Warning: Missing </span><span class="s0">{</span><span class="s1">param</span><span class="s0">} </span><span class="s4">in pre_itug for </span><span class="s0">{</span><span class="s1">participant_name</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
                    <span class="s0">else</span><span class="s2">:</span>
                        <span class="s3"># For PC1 parameters and others</span>
                        <span class="s1">param_key </span><span class="s2">= </span><span class="s1">param</span>
                        <span class="s1">person_df</span><span class="s2">[</span><span class="s4">f'pre_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">] = </span><span class="s1">pre_itug</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">param_key</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Warning: Invalid or missing pre_itug_metrics for </span><span class="s0">{</span><span class="s1">participant_name</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
                <span class="s0">continue  </span><span class="s3"># Skip this participant if pre_itug data is invalid</span>

            <span class="s3"># Process post-ITUG metrics</span>
            <span class="s1">post_itug </span><span class="s2">= </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'post_itug_metrics'</span><span class="s2">, {})</span>
            <span class="s0">if </span><span class="s1">post_itug </span><span class="s0">and </span><span class="s1">post_itug</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'valid'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">):</span>
                <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">itug_params</span><span class="s2">:</span>
                    <span class="s3"># Handle PC2 parameters which might not be in the original data</span>
                    <span class="s0">if </span><span class="s1">param</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s4">'PC2'</span><span class="s2">) </span><span class="s0">and </span><span class="s1">param </span><span class="s0">not in </span><span class="s1">post_itug</span><span class="s2">:</span>
                        <span class="s1">person_df</span><span class="s2">[</span><span class="s4">f'post_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">] = </span><span class="s6">0</span>
                        <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Warning: Missing </span><span class="s0">{</span><span class="s1">param</span><span class="s0">} </span><span class="s4">in post_itug for </span><span class="s0">{</span><span class="s1">participant_name</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
                    <span class="s0">else</span><span class="s2">:</span>
                        <span class="s3"># For PC1 parameters and others</span>
                        <span class="s1">param_key </span><span class="s2">= </span><span class="s1">param</span>
                        <span class="s1">person_df</span><span class="s2">[</span><span class="s4">f'post_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">] = </span><span class="s1">post_itug</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">param_key</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Warning: Invalid or missing post_itug_metrics for </span><span class="s0">{</span><span class="s1">participant_name</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
                <span class="s0">continue  </span><span class="s3"># Skip this participant if post_itug data is invalid</span>

            <span class="s3"># Process pre-ISWAY metrics</span>
            <span class="s1">pre_isway </span><span class="s2">= </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'pre_isway_metrics'</span><span class="s2">, {})</span>
            <span class="s0">if </span><span class="s1">pre_isway </span><span class="s0">and </span><span class="s1">pre_isway</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'valid'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">):</span>
                <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">isway_params</span><span class="s2">:</span>
                    <span class="s1">person_df</span><span class="s2">[</span><span class="s4">f'pre_isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">] = </span><span class="s1">pre_isway</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">param</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Warning: Invalid or missing pre_isway_metrics for </span><span class="s0">{</span><span class="s1">participant_name</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
                <span class="s0">continue  </span><span class="s3"># Skip this participant if pre_isway data is invalid</span>

            <span class="s3"># Process post-ISWAY metrics</span>
            <span class="s1">post_isway </span><span class="s2">= </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'post_isway_metrics'</span><span class="s2">, {})</span>
            <span class="s0">if </span><span class="s1">post_isway </span><span class="s0">and </span><span class="s1">post_isway</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'valid'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">):</span>
                <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">isway_params</span><span class="s2">:</span>
                    <span class="s1">person_df</span><span class="s2">[</span><span class="s4">f'post_isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">] = </span><span class="s1">post_isway</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">param</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Warning: Invalid or missing post_isway_metrics for </span><span class="s0">{</span><span class="s1">participant_name</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
                <span class="s0">continue  </span><span class="s3"># Skip this participant if post_isway data is invalid</span>

            <span class="s3"># Process food choice ratings</span>
            <span class="s1">person_df</span><span class="s2">[</span><span class="s4">'average_initial_rating'</span><span class="s2">] = </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'initial_rating'</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>
            <span class="s1">person_df</span><span class="s2">[</span><span class="s4">'average_final_rating'</span><span class="s2">] = </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'final_rating'</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>
            <span class="s1">person_df</span><span class="s2">[</span><span class="s4">'average_rejected_difference'</span><span class="s2">] = </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'rejected_pair_rating_diff'</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>
            <span class="s1">person_df</span><span class="s2">[</span><span class="s4">'average_rating_change'</span><span class="s2">] = </span><span class="s1">abs</span><span class="s2">(</span>
                <span class="s1">person_df</span><span class="s2">[</span><span class="s4">'average_final_rating'</span><span class="s2">] - </span><span class="s1">person_df</span><span class="s2">[</span><span class="s4">'average_initial_rating'</span><span class="s2">])</span>

            <span class="s3"># Additional food choice metrics</span>
            <span class="s1">person_df</span><span class="s2">[</span><span class="s4">'chosen_pair_rating_diff'</span><span class="s2">] = </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'chosen_pair_rating_diff'</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>
            <span class="s1">person_df</span><span class="s2">[</span><span class="s4">'computer_pair_rating_diff'</span><span class="s2">] = </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'computer_pair_rating_diff'</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>
            <span class="s1">person_df</span><span class="s2">[</span><span class="s4">'timeout_count'</span><span class="s2">] = </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'timeout_count'</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>

            <span class="s3"># Debug print</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Successfully processed participant </span><span class="s0">{</span><span class="s1">participant_name</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;  average_initial_rating: </span><span class="s0">{</span><span class="s1">person_df</span><span class="s2">[</span><span class="s4">'average_initial_rating'</span><span class="s2">].</span><span class="s1">iloc</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;  average_final_rating: </span><span class="s0">{</span><span class="s1">person_df</span><span class="s2">[</span><span class="s4">'average_final_rating'</span><span class="s2">].</span><span class="s1">iloc</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;  average_rating_change: </span><span class="s0">{</span><span class="s1">person_df</span><span class="s2">[</span><span class="s4">'average_rating_change'</span><span class="s2">].</span><span class="s1">iloc</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;  average_rejected_difference: </span><span class="s0">{</span><span class="s1">person_df</span><span class="s2">[</span><span class="s4">'average_rejected_difference'</span><span class="s2">].</span><span class="s1">iloc</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

            <span class="s1">df_list</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">person_df</span><span class="s2">)</span>

        <span class="s0">except </span><span class="s1">json</span><span class="s2">.</span><span class="s1">JSONDecodeError</span><span class="s2">:</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Warning: Invalid JSON in participant summary file: </span><span class="s0">{</span><span class="s1">participant_summary_path</span><span class="s0">}</span><span class="s4">. Skipping.&quot;</span><span class="s2">)</span>
        <span class="s0">except </span><span class="s1">Exception </span><span class="s0">as </span><span class="s1">e</span><span class="s2">:</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Error processing </span><span class="s0">{</span><span class="s1">participant_name</span><span class="s0">}</span><span class="s4">: </span><span class="s0">{</span><span class="s1">str</span><span class="s2">(</span><span class="s1">e</span><span class="s2">)</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

    <span class="s0">if not </span><span class="s1">df_list</span><span class="s2">:</span>
        <span class="s0">raise </span><span class="s1">ValueError</span><span class="s2">(</span><span class="s4">&quot;No valid participants found. Analysis cannot proceed.&quot;</span><span class="s2">)</span>

    <span class="s1">df </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">df_list</span><span class="s2">, </span><span class="s1">ignore_index</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Total participants included in analysis: </span><span class="s0">{</span><span class="s1">len</span><span class="s2">(</span><span class="s1">df</span><span class="s2">)</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">df</span>


<span class="s0">def </span><span class="s1">calculate_balance_changes</span><span class="s2">(</span><span class="s1">df</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;Calculate changes in balance parameters from pre to post test.&quot;&quot;&quot;</span>
    <span class="s1">balance_changes </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">()</span>
    <span class="s1">balance_changes</span><span class="s2">[</span><span class="s4">'name'</span><span class="s2">] = </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'name'</span><span class="s2">]</span>
    <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">itug_params</span><span class="s2">:</span>
        <span class="s1">balance_changes</span><span class="s2">[</span><span class="s4">f'itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">_change'</span><span class="s2">] = </span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'post_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">] - </span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'pre_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">]</span>
    <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">isway_params</span><span class="s2">:</span>
        <span class="s1">balance_changes</span><span class="s2">[</span><span class="s4">f'isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">_change'</span><span class="s2">] = </span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'post_isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">] - </span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'pre_isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">]</span>
    <span class="s0">return </span><span class="s1">balance_changes</span>


<span class="s0">def </span><span class="s1">correlation_analysis</span><span class="s2">(</span><span class="s1">df</span><span class="s2">, </span><span class="s1">balance_changes</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;Perform correlation analysis between balance parameters and food choice metrics.&quot;&quot;&quot;</span>
    <span class="s1">results </span><span class="s2">= []</span>
    <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">=== CORRELATION ANALYSIS ===</span><span class="s0">\n</span><span class="s4">&quot;</span><span class="s2">)</span>

    <span class="s3"># Check for constant variables</span>
    <span class="s0">if </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'average_rating_change'</span><span class="s2">].</span><span class="s1">nunique</span><span class="s2">() &lt;= </span><span class="s6">1</span><span class="s2">:</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;Warning: average_rating_change is constant. Skipping correlations with this variable.&quot;</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'average_rejected_difference'</span><span class="s2">].</span><span class="s1">nunique</span><span class="s2">() &lt;= </span><span class="s6">1</span><span class="s2">:</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;Warning: average_rejected_difference is constant. Skipping correlations with this variable.&quot;</span><span class="s2">)</span>

    <span class="s3"># Add chosen_pair_rating_diff to the analysis</span>
    <span class="s1">cd_measures </span><span class="s2">= [</span><span class="s4">'average_rating_change'</span><span class="s2">, </span><span class="s4">'average_rejected_difference'</span><span class="s2">, </span><span class="s4">'chosen_pair_rating_diff'</span><span class="s2">]</span>

    <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">itug_params</span><span class="s2">:</span>
        <span class="s0">for </span><span class="s1">cd_measure </span><span class="s0">in </span><span class="s1">cd_measures</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">df</span><span class="s2">[</span><span class="s1">cd_measure</span><span class="s2">].</span><span class="s1">nunique</span><span class="s2">() &gt; </span><span class="s6">1</span><span class="s2">:</span>
                <span class="s1">x </span><span class="s2">= </span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'pre_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">]</span>
                <span class="s1">y </span><span class="s2">= </span><span class="s1">df</span><span class="s2">[</span><span class="s1">cd_measure</span><span class="s2">]</span>
                <span class="s0">if </span><span class="s1">x</span><span class="s2">.</span><span class="s1">var</span><span class="s2">() &gt; </span><span class="s6">0 </span><span class="s0">and </span><span class="s1">y</span><span class="s2">.</span><span class="s1">var</span><span class="s2">() &gt; </span><span class="s6">0</span><span class="s2">:</span>
                    <span class="s1">corr</span><span class="s2">, </span><span class="s1">p </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">pearsonr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
                    <span class="s1">significance </span><span class="s2">= </span><span class="s4">'***' </span><span class="s0">if </span><span class="s1">p </span><span class="s2">&lt; </span><span class="s6">0.001 </span><span class="s0">else </span><span class="s4">'**' </span><span class="s0">if </span><span class="s1">p </span><span class="s2">&lt; </span><span class="s6">0.01 </span><span class="s0">else </span><span class="s4">'*' </span><span class="s0">if </span><span class="s1">p </span><span class="s2">&lt; </span><span class="s6">0.05 </span><span class="s0">else </span><span class="s4">'ns'</span>
                    <span class="s1">results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">({</span>
                        <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ITUG'</span><span class="s2">,</span>
                        <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                        <span class="s4">'cd_measure'</span><span class="s2">: </span><span class="s1">cd_measure</span><span class="s2">,</span>
                        <span class="s4">'correlation'</span><span class="s2">: </span><span class="s1">corr</span><span class="s2">,</span>
                        <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">p</span><span class="s2">,</span>
                        <span class="s4">'significance'</span><span class="s2">: </span><span class="s1">significance</span>
                    <span class="s2">})</span>
                <span class="s0">else</span><span class="s2">:</span>
                    <span class="s1">results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">({</span>
                        <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ITUG'</span><span class="s2">,</span>
                        <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                        <span class="s4">'cd_measure'</span><span class="s2">: </span><span class="s1">cd_measure</span><span class="s2">,</span>
                        <span class="s4">'correlation'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">,</span>
                        <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">,</span>
                        <span class="s4">'significance'</span><span class="s2">: </span><span class="s4">'ns'</span>
                    <span class="s2">})</span>

    <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">isway_params</span><span class="s2">:</span>
        <span class="s0">for </span><span class="s1">cd_measure </span><span class="s0">in </span><span class="s1">cd_measures</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">df</span><span class="s2">[</span><span class="s1">cd_measure</span><span class="s2">].</span><span class="s1">nunique</span><span class="s2">() &gt; </span><span class="s6">1</span><span class="s2">:</span>
                <span class="s1">x </span><span class="s2">= </span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'pre_isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">]</span>
                <span class="s1">y </span><span class="s2">= </span><span class="s1">df</span><span class="s2">[</span><span class="s1">cd_measure</span><span class="s2">]</span>
                <span class="s0">if </span><span class="s1">x</span><span class="s2">.</span><span class="s1">var</span><span class="s2">() &gt; </span><span class="s6">0 </span><span class="s0">and </span><span class="s1">y</span><span class="s2">.</span><span class="s1">var</span><span class="s2">() &gt; </span><span class="s6">0</span><span class="s2">:</span>
                    <span class="s1">corr</span><span class="s2">, </span><span class="s1">p </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">pearsonr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
                    <span class="s1">significance </span><span class="s2">= </span><span class="s4">'***' </span><span class="s0">if </span><span class="s1">p </span><span class="s2">&lt; </span><span class="s6">0.001 </span><span class="s0">else </span><span class="s4">'**' </span><span class="s0">if </span><span class="s1">p </span><span class="s2">&lt; </span><span class="s6">0.01 </span><span class="s0">else </span><span class="s4">'*' </span><span class="s0">if </span><span class="s1">p </span><span class="s2">&lt; </span><span class="s6">0.05 </span><span class="s0">else </span><span class="s4">'ns'</span>
                    <span class="s1">results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">({</span>
                        <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ISWAY'</span><span class="s2">,</span>
                        <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                        <span class="s4">'cd_measure'</span><span class="s2">: </span><span class="s1">cd_measure</span><span class="s2">,</span>
                        <span class="s4">'correlation'</span><span class="s2">: </span><span class="s1">corr</span><span class="s2">,</span>
                        <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">p</span><span class="s2">,</span>
                        <span class="s4">'significance'</span><span class="s2">: </span><span class="s1">significance</span>
                    <span class="s2">})</span>
                <span class="s0">else</span><span class="s2">:</span>
                    <span class="s1">results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">({</span>
                        <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ISWAY'</span><span class="s2">,</span>
                        <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                        <span class="s4">'cd_measure'</span><span class="s2">: </span><span class="s1">cd_measure</span><span class="s2">,</span>
                        <span class="s4">'correlation'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">,</span>
                        <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">,</span>
                        <span class="s4">'significance'</span><span class="s2">: </span><span class="s4">'ns'</span>
                    <span class="s2">})</span>

    <span class="s0">return </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">results</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">linear_regression_analysis</span><span class="s2">(</span><span class="s1">df</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;Perform linear regression analysis.&quot;&quot;&quot;</span>
    <span class="s1">results </span><span class="s2">= []</span>
    <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">=== LINEAR REGRESSION ANALYSIS ===</span><span class="s0">\n</span><span class="s4">&quot;</span><span class="s2">)</span>

    <span class="s1">cd_measures </span><span class="s2">= [</span><span class="s4">'average_rating_change'</span><span class="s2">, </span><span class="s4">'average_rejected_difference'</span><span class="s2">, </span><span class="s4">'chosen_pair_rating_diff'</span><span class="s2">]</span>

    <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">itug_params </span><span class="s2">+ </span><span class="s1">isway_params</span><span class="s2">:</span>
        <span class="s0">for </span><span class="s1">cd_measure </span><span class="s0">in </span><span class="s1">cd_measures</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">df</span><span class="s2">[</span><span class="s1">cd_measure</span><span class="s2">].</span><span class="s1">nunique</span><span class="s2">() &gt; </span><span class="s6">1</span><span class="s2">:</span>
                <span class="s1">y </span><span class="s2">= </span><span class="s1">df</span><span class="s2">[</span><span class="s1">cd_measure</span><span class="s2">]</span>
                <span class="s1">prefix </span><span class="s2">= </span><span class="s4">'pre_itug_' </span><span class="s0">if </span><span class="s1">param </span><span class="s0">in </span><span class="s1">itug_params </span><span class="s0">else </span><span class="s4">'pre_isway_'</span>
                <span class="s1">X </span><span class="s2">= </span><span class="s1">df</span><span class="s2">[[</span><span class="s1">prefix </span><span class="s2">+ </span><span class="s1">param</span><span class="s2">, </span><span class="s4">'age'</span><span class="s2">, </span><span class="s4">'bmi'</span><span class="s2">]]</span>
                <span class="s1">X </span><span class="s2">= </span><span class="s1">sm</span><span class="s2">.</span><span class="s1">add_constant</span><span class="s2">(</span><span class="s1">X</span><span class="s2">)</span>
                <span class="s0">if </span><span class="s1">y</span><span class="s2">.</span><span class="s1">var</span><span class="s2">() &gt; </span><span class="s6">0</span><span class="s2">:</span>
                    <span class="s1">model </span><span class="s2">= </span><span class="s1">sm</span><span class="s2">.</span><span class="s1">OLS</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">X</span><span class="s2">).</span><span class="s1">fit</span><span class="s2">()</span>
                    <span class="s1">results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">({</span>
                        <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ITUG' </span><span class="s0">if </span><span class="s1">param </span><span class="s0">in </span><span class="s1">itug_params </span><span class="s0">else </span><span class="s4">'ISWAY'</span><span class="s2">,</span>
                        <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                        <span class="s4">'cd_measure'</span><span class="s2">: </span><span class="s1">cd_measure</span><span class="s2">,</span>
                        <span class="s4">'r_squared'</span><span class="s2">: </span><span class="s1">model</span><span class="s2">.</span><span class="s1">rsquared</span><span class="s2">,</span>
                        <span class="s4">'f_statistic'</span><span class="s2">: </span><span class="s1">model</span><span class="s2">.</span><span class="s1">fvalue</span><span class="s2">,</span>
                        <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">model</span><span class="s2">.</span><span class="s1">f_pvalue</span><span class="s2">,</span>
                        <span class="s4">'significant'</span><span class="s2">: </span><span class="s1">model</span><span class="s2">.</span><span class="s1">f_pvalue </span><span class="s2">&lt; </span><span class="s6">0.05</span>
                    <span class="s2">})</span>
                <span class="s0">else</span><span class="s2">:</span>
                    <span class="s1">results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">({</span>
                        <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ITUG' </span><span class="s0">if </span><span class="s1">param </span><span class="s0">in </span><span class="s1">itug_params </span><span class="s0">else </span><span class="s4">'ISWAY'</span><span class="s2">,</span>
                        <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                        <span class="s4">'cd_measure'</span><span class="s2">: </span><span class="s1">cd_measure</span><span class="s2">,</span>
                        <span class="s4">'r_squared'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">,</span>
                        <span class="s4">'f_statistic'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">,</span>
                        <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">,</span>
                        <span class="s4">'significant'</span><span class="s2">: </span><span class="s0">False</span>
                    <span class="s2">})</span>

    <span class="s0">return </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">results</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">anova_analysis</span><span class="s2">(</span><span class="s1">df</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;Perform ANOVA analysis to test differences between pre and post measures.&quot;&quot;&quot;</span>
    <span class="s1">results </span><span class="s2">= []</span>
    <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">=== ANOVA ANALYSIS ===</span><span class="s0">\n</span><span class="s4">&quot;</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">itug_params</span><span class="s2">:</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">melt</span><span class="s2">(</span><span class="s1">df</span><span class="s2">, </span><span class="s1">id_vars</span><span class="s2">=[</span><span class="s4">'name'</span><span class="s2">], </span><span class="s1">value_vars</span><span class="s2">=[</span><span class="s4">f'pre_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">, </span><span class="s4">f'post_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">],</span>
                       <span class="s1">var_name</span><span class="s2">=</span><span class="s4">'time'</span><span class="s2">, </span><span class="s1">value_name</span><span class="s2">=</span><span class="s4">'value'</span><span class="s2">)</span>
        <span class="s1">model </span><span class="s2">= </span><span class="s1">ols</span><span class="s2">(</span><span class="s4">'value ~ time'</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">).</span><span class="s1">fit</span><span class="s2">()</span>
        <span class="s1">anova_table </span><span class="s2">= </span><span class="s1">sm</span><span class="s2">.</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">anova_lm</span><span class="s2">(</span><span class="s1">model</span><span class="s2">, </span><span class="s1">typ</span><span class="s2">=</span><span class="s6">2</span><span class="s2">)</span>
        <span class="s1">results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">({</span>
            <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ITUG'</span><span class="s2">,</span>
            <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
            <span class="s4">'F_value'</span><span class="s2">: </span><span class="s1">anova_table</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">'time'</span><span class="s2">, </span><span class="s4">'F'</span><span class="s2">],</span>
            <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">anova_table</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">'time'</span><span class="s2">, </span><span class="s4">'PR(&gt;F)'</span><span class="s2">],</span>
            <span class="s4">'significant'</span><span class="s2">: </span><span class="s1">anova_table</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">'time'</span><span class="s2">, </span><span class="s4">'PR(&gt;F)'</span><span class="s2">] &lt; </span><span class="s6">0.05</span>
        <span class="s2">})</span>

    <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">isway_params</span><span class="s2">:</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">melt</span><span class="s2">(</span><span class="s1">df</span><span class="s2">, </span><span class="s1">id_vars</span><span class="s2">=[</span><span class="s4">'name'</span><span class="s2">], </span><span class="s1">value_vars</span><span class="s2">=[</span><span class="s4">f'pre_isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">, </span><span class="s4">f'post_isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">],</span>
                       <span class="s1">var_name</span><span class="s2">=</span><span class="s4">'time'</span><span class="s2">, </span><span class="s1">value_name</span><span class="s2">=</span><span class="s4">'value'</span><span class="s2">)</span>
        <span class="s1">model </span><span class="s2">= </span><span class="s1">ols</span><span class="s2">(</span><span class="s4">'value ~ time'</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">).</span><span class="s1">fit</span><span class="s2">()</span>
        <span class="s1">anova_table </span><span class="s2">= </span><span class="s1">sm</span><span class="s2">.</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">anova_lm</span><span class="s2">(</span><span class="s1">model</span><span class="s2">, </span><span class="s1">typ</span><span class="s2">=</span><span class="s6">2</span><span class="s2">)</span>
        <span class="s1">results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">({</span>
            <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ISWAY'</span><span class="s2">,</span>
            <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
            <span class="s4">'F_value'</span><span class="s2">: </span><span class="s1">anova_table</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">'time'</span><span class="s2">, </span><span class="s4">'F'</span><span class="s2">],</span>
            <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">anova_table</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">'time'</span><span class="s2">, </span><span class="s4">'PR(&gt;F)'</span><span class="s2">],</span>
            <span class="s4">'significant'</span><span class="s2">: </span><span class="s1">anova_table</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">'time'</span><span class="s2">, </span><span class="s4">'PR(&gt;F)'</span><span class="s2">] &lt; </span><span class="s6">0.05</span>
        <span class="s2">})</span>

    <span class="s0">return </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">results</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">paired_ttest_analysis</span><span class="s2">(</span><span class="s1">df</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;Perform paired t-test analysis between pre and post measures.&quot;&quot;&quot;</span>
    <span class="s1">results </span><span class="s2">= []</span>
    <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">=== PAIRED T-TEST ANALYSIS ===</span><span class="s0">\n</span><span class="s4">&quot;</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">itug_params</span><span class="s2">:</span>
        <span class="s1">pre </span><span class="s2">= </span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'pre_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">]</span>
        <span class="s1">post </span><span class="s2">= </span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'post_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">]</span>
        <span class="s0">if </span><span class="s1">pre</span><span class="s2">.</span><span class="s1">var</span><span class="s2">() &gt; </span><span class="s6">0 </span><span class="s0">and </span><span class="s1">post</span><span class="s2">.</span><span class="s1">var</span><span class="s2">() &gt; </span><span class="s6">0</span><span class="s2">:</span>
            <span class="s1">t_stat</span><span class="s2">, </span><span class="s1">p_val </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">ttest_rel</span><span class="s2">(</span><span class="s1">pre</span><span class="s2">, </span><span class="s1">post</span><span class="s2">)</span>
            <span class="s1">results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">({</span>
                <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ITUG'</span><span class="s2">,</span>
                <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                <span class="s4">'t_statistic'</span><span class="s2">: </span><span class="s1">t_stat</span><span class="s2">,</span>
                <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">p_val</span><span class="s2">,</span>
                <span class="s4">'significant'</span><span class="s2">: </span><span class="s1">p_val </span><span class="s2">&lt; </span><span class="s6">0.05</span>
            <span class="s2">})</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">({</span>
                <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ITUG'</span><span class="s2">,</span>
                <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                <span class="s4">'t_statistic'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">,</span>
                <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">,</span>
                <span class="s4">'significant'</span><span class="s2">: </span><span class="s0">False</span>
            <span class="s2">})</span>

    <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">isway_params</span><span class="s2">:</span>
        <span class="s1">pre </span><span class="s2">= </span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'pre_isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">]</span>
        <span class="s1">post </span><span class="s2">= </span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'post_isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">]</span>
        <span class="s0">if </span><span class="s1">pre</span><span class="s2">.</span><span class="s1">var</span><span class="s2">() &gt; </span><span class="s6">0 </span><span class="s0">and </span><span class="s1">post</span><span class="s2">.</span><span class="s1">var</span><span class="s2">() &gt; </span><span class="s6">0</span><span class="s2">:</span>
            <span class="s1">t_stat</span><span class="s2">, </span><span class="s1">p_val </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">ttest_rel</span><span class="s2">(</span><span class="s1">pre</span><span class="s2">, </span><span class="s1">post</span><span class="s2">)</span>
            <span class="s1">results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">({</span>
                <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ISWAY'</span><span class="s2">,</span>
                <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                <span class="s4">'t_statistic'</span><span class="s2">: </span><span class="s1">t_stat</span><span class="s2">,</span>
                <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">p_val</span><span class="s2">,</span>
                <span class="s4">'significant'</span><span class="s2">: </span><span class="s1">p_val </span><span class="s2">&lt; </span><span class="s6">0.05</span>
            <span class="s2">})</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">({</span>
                <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ISWAY'</span><span class="s2">,</span>
                <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                <span class="s4">'t_statistic'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">,</span>
                <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">,</span>
                <span class="s4">'significant'</span><span class="s2">: </span><span class="s0">False</span>
            <span class="s2">})</span>

    <span class="s0">return </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">results</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">change_score_analysis</span><span class="s2">(</span><span class="s1">balance_changes</span><span class="s2">, </span><span class="s1">df</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;Analyze correlations between balance changes and food choice metrics.&quot;&quot;&quot;</span>
    <span class="s1">results </span><span class="s2">= []</span>
    <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">=== CHANGE SCORE ANALYSIS ===</span><span class="s0">\n</span><span class="s4">&quot;</span><span class="s2">)</span>

    <span class="s1">cd_measures </span><span class="s2">= [</span><span class="s4">'average_rating_change'</span><span class="s2">, </span><span class="s4">'average_rejected_difference'</span><span class="s2">, </span><span class="s4">'chosen_pair_rating_diff'</span><span class="s2">]</span>

    <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">itug_params</span><span class="s2">:</span>
        <span class="s0">for </span><span class="s1">cd_measure </span><span class="s0">in </span><span class="s1">cd_measures</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">df</span><span class="s2">[</span><span class="s1">cd_measure</span><span class="s2">].</span><span class="s1">nunique</span><span class="s2">() &gt; </span><span class="s6">1</span><span class="s2">:</span>
                <span class="s1">x </span><span class="s2">= </span><span class="s1">balance_changes</span><span class="s2">[</span><span class="s4">f'itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">_change'</span><span class="s2">]</span>
                <span class="s1">y </span><span class="s2">= </span><span class="s1">df</span><span class="s2">[</span><span class="s1">cd_measure</span><span class="s2">]</span>
                <span class="s0">if </span><span class="s1">x</span><span class="s2">.</span><span class="s1">var</span><span class="s2">() &gt; </span><span class="s6">0 </span><span class="s0">and </span><span class="s1">y</span><span class="s2">.</span><span class="s1">var</span><span class="s2">() &gt; </span><span class="s6">0</span><span class="s2">:</span>
                    <span class="s1">corr</span><span class="s2">, </span><span class="s1">p </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">pearsonr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
                    <span class="s1">significance </span><span class="s2">= </span><span class="s4">'***' </span><span class="s0">if </span><span class="s1">p </span><span class="s2">&lt; </span><span class="s6">0.001 </span><span class="s0">else </span><span class="s4">'**' </span><span class="s0">if </span><span class="s1">p </span><span class="s2">&lt; </span><span class="s6">0.01 </span><span class="s0">else </span><span class="s4">'*' </span><span class="s0">if </span><span class="s1">p </span><span class="s2">&lt; </span><span class="s6">0.05 </span><span class="s0">else </span><span class="s4">'ns'</span>
                    <span class="s1">results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">({</span>
                        <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ITUG'</span><span class="s2">,</span>
                        <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                        <span class="s4">'cd_measure'</span><span class="s2">: </span><span class="s1">cd_measure</span><span class="s2">,</span>
                        <span class="s4">'correlation'</span><span class="s2">: </span><span class="s1">corr</span><span class="s2">,</span>
                        <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">p</span><span class="s2">,</span>
                        <span class="s4">'significance'</span><span class="s2">: </span><span class="s1">significance</span>
                    <span class="s2">})</span>
                <span class="s0">else</span><span class="s2">:</span>
                    <span class="s1">results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">({</span>
                        <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ITUG'</span><span class="s2">,</span>
                        <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                        <span class="s4">'cd_measure'</span><span class="s2">: </span><span class="s1">cd_measure</span><span class="s2">,</span>
                        <span class="s4">'correlation'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">,</span>
                        <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">,</span>
                        <span class="s4">'significance'</span><span class="s2">: </span><span class="s4">'ns'</span>
                    <span class="s2">})</span>

    <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">isway_params</span><span class="s2">:</span>
        <span class="s0">for </span><span class="s1">cd_measure </span><span class="s0">in </span><span class="s1">cd_measures</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">df</span><span class="s2">[</span><span class="s1">cd_measure</span><span class="s2">].</span><span class="s1">nunique</span><span class="s2">() &gt; </span><span class="s6">1</span><span class="s2">:</span>
                <span class="s1">x </span><span class="s2">= </span><span class="s1">balance_changes</span><span class="s2">[</span><span class="s4">f'isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">_change'</span><span class="s2">]</span>
                <span class="s1">y </span><span class="s2">= </span><span class="s1">df</span><span class="s2">[</span><span class="s1">cd_measure</span><span class="s2">]</span>
                <span class="s0">if </span><span class="s1">x</span><span class="s2">.</span><span class="s1">var</span><span class="s2">() &gt; </span><span class="s6">0 </span><span class="s0">and </span><span class="s1">y</span><span class="s2">.</span><span class="s1">var</span><span class="s2">() &gt; </span><span class="s6">0</span><span class="s2">:</span>
                    <span class="s1">corr</span><span class="s2">, </span><span class="s1">p </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">pearsonr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
                    <span class="s1">significance </span><span class="s2">= </span><span class="s4">'***' </span><span class="s0">if </span><span class="s1">p </span><span class="s2">&lt; </span><span class="s6">0.001 </span><span class="s0">else </span><span class="s4">'**' </span><span class="s0">if </span><span class="s1">p </span><span class="s2">&lt; </span><span class="s6">0.01 </span><span class="s0">else </span><span class="s4">'*' </span><span class="s0">if </span><span class="s1">p </span><span class="s2">&lt; </span><span class="s6">0.05 </span><span class="s0">else </span><span class="s4">'ns'</span>
                    <span class="s1">results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">({</span>
                        <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ISWAY'</span><span class="s2">,</span>
                        <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                        <span class="s4">'cd_measure'</span><span class="s2">: </span><span class="s1">cd_measure</span><span class="s2">,</span>
                        <span class="s4">'correlation'</span><span class="s2">: </span><span class="s1">corr</span><span class="s2">,</span>
                        <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">p</span><span class="s2">,</span>
                        <span class="s4">'significance'</span><span class="s2">: </span><span class="s1">significance</span>
                    <span class="s2">})</span>
                <span class="s0">else</span><span class="s2">:</span>
                    <span class="s1">results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">({</span>
                        <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ISWAY'</span><span class="s2">,</span>
                        <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                        <span class="s4">'cd_measure'</span><span class="s2">: </span><span class="s1">cd_measure</span><span class="s2">,</span>
                        <span class="s4">'correlation'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">,</span>
                        <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">,</span>
                        <span class="s4">'significance'</span><span class="s2">: </span><span class="s4">'ns'</span>
                    <span class="s2">})</span>

    <span class="s0">return </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">results</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">mixed_effects_model</span><span class="s2">(</span><span class="s1">df</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;Perform mixed effects modeling.&quot;&quot;&quot;</span>
    <span class="s1">results </span><span class="s2">= []</span>
    <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">=== MIXED EFFECTS MODEL ===</span><span class="s0">\n</span><span class="s4">&quot;</span><span class="s2">)</span>

    <span class="s1">cd_measures </span><span class="s2">= [</span><span class="s4">'average_rating_change'</span><span class="s2">, </span><span class="s4">'average_rejected_difference'</span><span class="s2">, </span><span class="s4">'chosen_pair_rating_diff'</span><span class="s2">]</span>

    <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">itug_params </span><span class="s2">+ </span><span class="s1">isway_params</span><span class="s2">:</span>
        <span class="s0">for </span><span class="s1">cd_measure </span><span class="s0">in </span><span class="s1">cd_measures</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">df</span><span class="s2">[</span><span class="s1">cd_measure</span><span class="s2">].</span><span class="s1">nunique</span><span class="s2">() &gt; </span><span class="s6">1</span><span class="s2">:</span>
                <span class="s1">prefix </span><span class="s2">= </span><span class="s4">'pre_itug_' </span><span class="s0">if </span><span class="s1">param </span><span class="s0">in </span><span class="s1">itug_params </span><span class="s0">else </span><span class="s4">'pre_isway_'</span>
                <span class="s1">data </span><span class="s2">= </span><span class="s1">df</span><span class="s2">[[</span><span class="s1">cd_measure</span><span class="s2">, </span><span class="s1">prefix </span><span class="s2">+ </span><span class="s1">param</span><span class="s2">, </span><span class="s4">'age'</span><span class="s2">, </span><span class="s4">'bmi'</span><span class="s2">, </span><span class="s4">'name'</span><span class="s2">]].</span><span class="s1">copy</span><span class="s2">()</span>
                <span class="s1">data </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">rename</span><span class="s2">(</span><span class="s1">columns</span><span class="s2">={</span><span class="s1">cd_measure</span><span class="s2">: </span><span class="s4">'cd_measure'</span><span class="s2">, </span><span class="s1">prefix </span><span class="s2">+ </span><span class="s1">param</span><span class="s2">: </span><span class="s4">'balance_param'</span><span class="s2">})</span>
                <span class="s0">if </span><span class="s1">data</span><span class="s2">[</span><span class="s4">'cd_measure'</span><span class="s2">].</span><span class="s1">var</span><span class="s2">() &gt; </span><span class="s6">0 </span><span class="s0">and </span><span class="s1">data</span><span class="s2">[</span><span class="s4">'balance_param'</span><span class="s2">].</span><span class="s1">var</span><span class="s2">() &gt; </span><span class="s6">0</span><span class="s2">:</span>
                    <span class="s0">try</span><span class="s2">:</span>
                        <span class="s1">model </span><span class="s2">= </span><span class="s1">mixedlm</span><span class="s2">(</span><span class="s4">&quot;cd_measure ~ balance_param + age + bmi&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">groups</span><span class="s2">=</span><span class="s1">data</span><span class="s2">[</span><span class="s4">'name'</span><span class="s2">]).</span><span class="s1">fit</span><span class="s2">()</span>
                        <span class="s1">results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">({</span>
                            <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ITUG' </span><span class="s0">if </span><span class="s1">param </span><span class="s0">in </span><span class="s1">itug_params </span><span class="s0">else </span><span class="s4">'ISWAY'</span><span class="s2">,</span>
                            <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                            <span class="s4">'cd_measure'</span><span class="s2">: </span><span class="s1">cd_measure</span><span class="s2">,</span>
                            <span class="s4">'coefficient'</span><span class="s2">: </span><span class="s1">model</span><span class="s2">.</span><span class="s1">params</span><span class="s2">[</span><span class="s4">'balance_param'</span><span class="s2">],</span>
                            <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">model</span><span class="s2">.</span><span class="s1">pvalues</span><span class="s2">[</span><span class="s4">'balance_param'</span><span class="s2">],</span>
                            <span class="s4">'significant'</span><span class="s2">: </span><span class="s1">model</span><span class="s2">.</span><span class="s1">pvalues</span><span class="s2">[</span><span class="s4">'balance_param'</span><span class="s2">] &lt; </span><span class="s6">0.05</span>
                        <span class="s2">})</span>
                    <span class="s0">except </span><span class="s1">Exception </span><span class="s0">as </span><span class="s1">e</span><span class="s2">:</span>
                        <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Error in mixed effects model for </span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">, </span><span class="s0">{</span><span class="s1">cd_measure</span><span class="s0">}</span><span class="s4">: </span><span class="s0">{</span><span class="s1">str</span><span class="s2">(</span><span class="s1">e</span><span class="s2">)</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
                        <span class="s1">results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">({</span>
                            <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ITUG' </span><span class="s0">if </span><span class="s1">param </span><span class="s0">in </span><span class="s1">itug_params </span><span class="s0">else </span><span class="s4">'ISWAY'</span><span class="s2">,</span>
                            <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                            <span class="s4">'cd_measure'</span><span class="s2">: </span><span class="s1">cd_measure</span><span class="s2">,</span>
                            <span class="s4">'coefficient'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">,</span>
                            <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">,</span>
                            <span class="s4">'significant'</span><span class="s2">: </span><span class="s0">False</span>
                        <span class="s2">})</span>
                <span class="s0">else</span><span class="s2">:</span>
                    <span class="s1">results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">({</span>
                        <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ITUG' </span><span class="s0">if </span><span class="s1">param </span><span class="s0">in </span><span class="s1">itug_params </span><span class="s0">else </span><span class="s4">'ISWAY'</span><span class="s2">,</span>
                        <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                        <span class="s4">'cd_measure'</span><span class="s2">: </span><span class="s1">cd_measure</span><span class="s2">,</span>
                        <span class="s4">'coefficient'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">,</span>
                        <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">,</span>
                        <span class="s4">'significant'</span><span class="s2">: </span><span class="s0">False</span>
                    <span class="s2">})</span>

    <span class="s0">return </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">results</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">demographic_summary</span><span class="s2">(</span><span class="s1">df</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;Create a summary of demographic information.&quot;&quot;&quot;</span>
    <span class="s1">demo_summary </span><span class="s2">= {</span>
        <span class="s4">'total_participants'</span><span class="s2">: </span><span class="s1">len</span><span class="s2">(</span><span class="s1">df</span><span class="s2">),</span>
        <span class="s4">'gender_distribution'</span><span class="s2">: </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'gender'</span><span class="s2">].</span><span class="s1">value_counts</span><span class="s2">().</span><span class="s1">to_dict</span><span class="s2">(),</span>
        <span class="s4">'age_mean'</span><span class="s2">: </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'age'</span><span class="s2">].</span><span class="s1">mean</span><span class="s2">(),</span>
        <span class="s4">'age_std'</span><span class="s2">: </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'age'</span><span class="s2">].</span><span class="s1">std</span><span class="s2">(),</span>
        <span class="s4">'age_range'</span><span class="s2">: [</span><span class="s1">df</span><span class="s2">[</span><span class="s4">'age'</span><span class="s2">].</span><span class="s1">min</span><span class="s2">(), </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'age'</span><span class="s2">].</span><span class="s1">max</span><span class="s2">()],</span>
        <span class="s4">'bmi_mean'</span><span class="s2">: </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'bmi'</span><span class="s2">].</span><span class="s1">mean</span><span class="s2">(),</span>
        <span class="s4">'bmi_std'</span><span class="s2">: </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'bmi'</span><span class="s2">].</span><span class="s1">std</span><span class="s2">(),</span>
        <span class="s4">'bmi_range'</span><span class="s2">: [</span><span class="s1">df</span><span class="s2">[</span><span class="s4">'bmi'</span><span class="s2">].</span><span class="s1">min</span><span class="s2">(), </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'bmi'</span><span class="s2">].</span><span class="s1">max</span><span class="s2">()]</span>
    <span class="s2">}</span>

    <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">=== DEMOGRAPHIC SUMMARY ===</span><span class="s0">\n</span><span class="s4">&quot;</span><span class="s2">)</span>
    <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Total participants: </span><span class="s0">{</span><span class="s1">demo_summary</span><span class="s2">[</span><span class="s4">'total_participants'</span><span class="s2">]</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
    <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Gender distribution: </span><span class="s0">{</span><span class="s1">demo_summary</span><span class="s2">[</span><span class="s4">'gender_distribution'</span><span class="s2">]</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
    <span class="s1">print</span><span class="s2">(</span>
        <span class="s4">f&quot;Age: Mean=</span><span class="s0">{</span><span class="s1">demo_summary</span><span class="s2">[</span><span class="s4">'age_mean'</span><span class="s2">]</span><span class="s0">:</span><span class="s4">.2f</span><span class="s0">}</span><span class="s4">, SD=</span><span class="s0">{</span><span class="s1">demo_summary</span><span class="s2">[</span><span class="s4">'age_std'</span><span class="s2">]</span><span class="s0">:</span><span class="s4">.2f</span><span class="s0">}</span><span class="s4">, Range=</span><span class="s0">{</span><span class="s1">demo_summary</span><span class="s2">[</span><span class="s4">'age_range'</span><span class="s2">]</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
    <span class="s1">print</span><span class="s2">(</span>
        <span class="s4">f&quot;BMI: Mean=</span><span class="s0">{</span><span class="s1">demo_summary</span><span class="s2">[</span><span class="s4">'bmi_mean'</span><span class="s2">]</span><span class="s0">:</span><span class="s4">.2f</span><span class="s0">}</span><span class="s4">, SD=</span><span class="s0">{</span><span class="s1">demo_summary</span><span class="s2">[</span><span class="s4">'bmi_std'</span><span class="s2">]</span><span class="s0">:</span><span class="s4">.2f</span><span class="s0">}</span><span class="s4">, Range=</span><span class="s0">{</span><span class="s1">demo_summary</span><span class="s2">[</span><span class="s4">'bmi_range'</span><span class="s2">]</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

    <span class="s0">return </span><span class="s1">demo_summary</span>


<span class="s0">def </span><span class="s1">create_visualizations</span><span class="s2">(</span><span class="s1">results</span><span class="s2">, </span><span class="s1">df</span><span class="s2">, </span><span class="s1">output_dir</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;Create and save visualizations for the analysis.&quot;&quot;&quot;</span>
    <span class="s1">os</span><span class="s2">.</span><span class="s1">makedirs</span><span class="s2">(</span><span class="s1">output_dir</span><span class="s2">, </span><span class="s1">exist_ok</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s3"># Save participant data for reference</span>
    <span class="s1">df</span><span class="s2">.</span><span class="s1">to_csv</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">output_dir</span><span class="s2">, </span><span class="s4">'participant_data.csv'</span><span class="s2">), </span><span class="s1">index</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

    <span class="s3"># Correlation Heatmap</span>
    <span class="s1">corr_df </span><span class="s2">= </span><span class="s1">results</span><span class="s2">[</span><span class="s4">'correlations'</span><span class="s2">]</span>
    <span class="s0">if not </span><span class="s1">corr_df</span><span class="s2">[</span><span class="s4">'correlation'</span><span class="s2">].</span><span class="s1">isna</span><span class="s2">().</span><span class="s1">all</span><span class="s2">():</span>
        <span class="s0">for </span><span class="s1">cd_measure </span><span class="s0">in </span><span class="s2">[</span><span class="s4">'average_rating_change'</span><span class="s2">, </span><span class="s4">'average_rejected_difference'</span><span class="s2">, </span><span class="s4">'chosen_pair_rating_diff'</span><span class="s2">]:</span>
            <span class="s1">measure_df </span><span class="s2">= </span><span class="s1">corr_df</span><span class="s2">[</span><span class="s1">corr_df</span><span class="s2">[</span><span class="s4">'cd_measure'</span><span class="s2">] == </span><span class="s1">cd_measure</span><span class="s2">]</span>
            <span class="s0">if not </span><span class="s1">measure_df</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">:</span>
                <span class="s1">pivot_data </span><span class="s2">= </span><span class="s1">measure_df</span><span class="s2">.</span><span class="s1">pivot_table</span><span class="s2">(</span>
                    <span class="s1">index</span><span class="s2">=[</span><span class="s4">'test_type'</span><span class="s2">, </span><span class="s4">'parameter'</span><span class="s2">],</span>
                    <span class="s1">values</span><span class="s2">=</span><span class="s4">'correlation'</span>
                <span class="s2">)</span>
                <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">10</span><span class="s2">, </span><span class="s6">8</span><span class="s2">))</span>
                <span class="s1">sns</span><span class="s2">.</span><span class="s1">heatmap</span><span class="s2">(</span><span class="s1">pivot_data</span><span class="s2">, </span><span class="s1">annot</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s4">'coolwarm'</span><span class="s2">, </span><span class="s1">center</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">vmin</span><span class="s2">=-</span><span class="s6">1</span><span class="s2">, </span><span class="s1">vmax</span><span class="s2">=</span><span class="s6">1</span><span class="s2">)</span>
                <span class="s1">plt</span><span class="s2">.</span><span class="s1">title</span><span class="s2">(</span><span class="s4">f'Correlation Heatmap - </span><span class="s0">{</span><span class="s1">cd_measure</span><span class="s0">}</span><span class="s4">'</span><span class="s2">)</span>
                <span class="s1">plt</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">output_dir</span><span class="s2">, </span><span class="s4">f'correlation_heatmap_</span><span class="s0">{</span><span class="s1">cd_measure</span><span class="s0">}</span><span class="s4">.png'</span><span class="s2">))</span>
                <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;Skipping correlation heatmap: all correlations are NaN.&quot;</span><span class="s2">)</span>

    <span class="s3"># Paired T-Test Bar Plots</span>
    <span class="s1">ttest_df </span><span class="s2">= </span><span class="s1">results</span><span class="s2">[</span><span class="s4">'ttest'</span><span class="s2">]</span>
    <span class="s0">for </span><span class="s1">test_type </span><span class="s0">in </span><span class="s2">[</span><span class="s4">'ITUG'</span><span class="s2">, </span><span class="s4">'ISWAY'</span><span class="s2">]:</span>
        <span class="s1">df_subset </span><span class="s2">= </span><span class="s1">ttest_df</span><span class="s2">[</span><span class="s1">ttest_df</span><span class="s2">[</span><span class="s4">'test_type'</span><span class="s2">] == </span><span class="s1">test_type</span><span class="s2">]</span>
        <span class="s0">if not </span><span class="s1">df_subset</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">:</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">10</span><span class="s2">, </span><span class="s6">6</span><span class="s2">))</span>
            <span class="s1">bars </span><span class="s2">= </span><span class="s1">sns</span><span class="s2">.</span><span class="s1">barplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=</span><span class="s4">'parameter'</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s4">'t_statistic'</span><span class="s2">, </span><span class="s1">hue</span><span class="s2">=</span><span class="s4">'significant'</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">df_subset</span><span class="s2">)</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">title</span><span class="s2">(</span><span class="s4">f'</span><span class="s0">{</span><span class="s1">test_type</span><span class="s0">} </span><span class="s4">Paired T-Test Results'</span><span class="s2">)</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">xticks</span><span class="s2">(</span><span class="s1">rotation</span><span class="s2">=</span><span class="s6">45</span><span class="s2">)</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">axhline</span><span class="s2">(</span><span class="s1">y</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'black'</span><span class="s2">, </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s4">'-'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s6">0.5</span><span class="s2">)</span>

            <span class="s3"># Add p-values above bars</span>
            <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">p </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">df_subset</span><span class="s2">[</span><span class="s4">'p_value'</span><span class="s2">]):</span>
                <span class="s0">if not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isnan</span><span class="s2">(</span><span class="s1">p</span><span class="s2">):</span>
                    <span class="s1">bars</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s4">f'p=</span><span class="s0">{</span><span class="s1">p</span><span class="s0">:</span><span class="s4">.3f</span><span class="s0">}</span><span class="s4">'</span><span class="s2">,</span>
                                  <span class="s2">(</span><span class="s1">i</span><span class="s2">, </span><span class="s1">df_subset</span><span class="s2">[</span><span class="s4">'t_statistic'</span><span class="s2">].</span><span class="s1">iloc</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]),</span>
                                  <span class="s1">ha</span><span class="s2">=</span><span class="s4">'center'</span><span class="s2">, </span><span class="s1">va</span><span class="s2">=</span><span class="s4">'bottom'</span><span class="s2">)</span>

            <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">output_dir</span><span class="s2">, </span><span class="s4">f'</span><span class="s0">{</span><span class="s1">test_type</span><span class="s0">}</span><span class="s4">_ttest_barplot.png'</span><span class="s2">))</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>

    <span class="s3"># Pre vs Post Comparison Plots</span>
    <span class="s0">for </span><span class="s1">test_type</span><span class="s2">, </span><span class="s1">params </span><span class="s0">in </span><span class="s2">[(</span><span class="s4">'ITUG'</span><span class="s2">, </span><span class="s1">itug_params</span><span class="s2">), (</span><span class="s4">'ISWAY'</span><span class="s2">, </span><span class="s1">isway_params</span><span class="s2">)]:</span>
        <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">params</span><span class="s2">:</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">10</span><span class="s2">, </span><span class="s6">6</span><span class="s2">))</span>
            <span class="s1">pre_column </span><span class="s2">= </span><span class="s4">f'pre_</span><span class="s0">{</span><span class="s1">test_type</span><span class="s2">.</span><span class="s1">lower</span><span class="s2">()</span><span class="s0">}</span><span class="s4">_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span>
            <span class="s1">post_column </span><span class="s2">= </span><span class="s4">f'post_</span><span class="s0">{</span><span class="s1">test_type</span><span class="s2">.</span><span class="s1">lower</span><span class="s2">()</span><span class="s0">}</span><span class="s4">_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span>

            <span class="s3"># Create a dataframe for plotting</span>
            <span class="s1">plot_df </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">({</span>
                <span class="s4">'Pre'</span><span class="s2">: </span><span class="s1">df</span><span class="s2">[</span><span class="s1">pre_column</span><span class="s2">],</span>
                <span class="s4">'Post'</span><span class="s2">: </span><span class="s1">df</span><span class="s2">[</span><span class="s1">post_column</span><span class="s2">]</span>
            <span class="s2">})</span>

            <span class="s3"># Plot means with error bars</span>
            <span class="s1">means </span><span class="s2">= </span><span class="s1">plot_df</span><span class="s2">.</span><span class="s1">mean</span><span class="s2">()</span>
            <span class="s1">sems </span><span class="s2">= </span><span class="s1">plot_df</span><span class="s2">.</span><span class="s1">sem</span><span class="s2">()</span>

            <span class="s1">plt</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([</span><span class="s4">'Pre'</span><span class="s2">, </span><span class="s4">'Post'</span><span class="s2">], </span><span class="s1">means</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=</span><span class="s1">sems</span><span class="s2">, </span><span class="s1">capsize</span><span class="s2">=</span><span class="s6">10</span><span class="s2">)</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">title</span><span class="s2">(</span><span class="s4">f'</span><span class="s0">{</span><span class="s1">test_type</span><span class="s0">} {</span><span class="s1">param</span><span class="s0">} </span><span class="s4">- Pre vs Post Comparison'</span><span class="s2">)</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">ylabel</span><span class="s2">(</span><span class="s4">'Value'</span><span class="s2">)</span>

            <span class="s3"># Add p-value from t-test</span>
            <span class="s1">t_result </span><span class="s2">= </span><span class="s1">ttest_df</span><span class="s2">[(</span><span class="s1">ttest_df</span><span class="s2">[</span><span class="s4">'test_type'</span><span class="s2">] == </span><span class="s1">test_type</span><span class="s2">) &amp; (</span><span class="s1">ttest_df</span><span class="s2">[</span><span class="s4">'parameter'</span><span class="s2">] == </span><span class="s1">param</span><span class="s2">)]</span>
            <span class="s0">if not </span><span class="s1">t_result</span><span class="s2">.</span><span class="s1">empty </span><span class="s0">and not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isnan</span><span class="s2">(</span><span class="s1">t_result</span><span class="s2">[</span><span class="s4">'p_value'</span><span class="s2">].</span><span class="s1">iloc</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]):</span>
                <span class="s1">p_val </span><span class="s2">= </span><span class="s1">t_result</span><span class="s2">[</span><span class="s4">'p_value'</span><span class="s2">].</span><span class="s1">iloc</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]</span>
                <span class="s1">sig_text </span><span class="s2">= </span><span class="s4">f'p=</span><span class="s0">{</span><span class="s1">p_val</span><span class="s0">:</span><span class="s4">.3f</span><span class="s0">}</span><span class="s4">'</span>
                <span class="s0">if </span><span class="s1">p_val </span><span class="s2">&lt; </span><span class="s6">0.05</span><span class="s2">:</span>
                    <span class="s1">sig_text </span><span class="s2">+= </span><span class="s4">' *'</span>
                <span class="s0">if </span><span class="s1">p_val </span><span class="s2">&lt; </span><span class="s6">0.01</span><span class="s2">:</span>
                    <span class="s1">sig_text </span><span class="s2">+= </span><span class="s4">'*'</span>
                <span class="s0">if </span><span class="s1">p_val </span><span class="s2">&lt; </span><span class="s6">0.001</span><span class="s2">:</span>
                    <span class="s1">sig_text </span><span class="s2">+= </span><span class="s4">'*'</span>

                <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s6">0.5</span><span class="s2">, </span><span class="s1">max</span><span class="s2">(</span><span class="s1">means</span><span class="s2">) * </span><span class="s6">1.1</span><span class="s2">, </span><span class="s1">sig_text</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s4">'center'</span><span class="s2">)</span>

            <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">output_dir</span><span class="s2">, </span><span class="s4">f'</span><span class="s0">{</span><span class="s1">test_type</span><span class="s0">}</span><span class="s4">_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">_pre_post_comparison.png'</span><span class="s2">))</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>

    <span class="s3"># Mixed Effects Model Forest Plot</span>
    <span class="s1">mixed_df </span><span class="s2">= </span><span class="s1">results</span><span class="s2">[</span><span class="s4">'mixed_effects'</span><span class="s2">]</span>
    <span class="s0">if not </span><span class="s1">mixed_df</span><span class="s2">[</span><span class="s4">'coefficient'</span><span class="s2">].</span><span class="s1">isna</span><span class="s2">().</span><span class="s1">all</span><span class="s2">():</span>
        <span class="s1">cd_measures </span><span class="s2">= </span><span class="s1">mixed_df</span><span class="s2">[</span><span class="s4">'cd_measure'</span><span class="s2">].</span><span class="s1">unique</span><span class="s2">()</span>
        <span class="s0">for </span><span class="s1">cd_measure </span><span class="s0">in </span><span class="s1">cd_measures</span><span class="s2">:</span>
            <span class="s1">measure_df </span><span class="s2">= </span><span class="s1">mixed_df</span><span class="s2">[</span><span class="s1">mixed_df</span><span class="s2">[</span><span class="s4">'cd_measure'</span><span class="s2">] == </span><span class="s1">cd_measure</span><span class="s2">]</span>
            <span class="s0">if not </span><span class="s1">measure_df</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">:</span>
                <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">10</span><span class="s2">, </span><span class="s6">8</span><span class="s2">))</span>
                <span class="s1">colors </span><span class="s2">= [</span><span class="s4">'green' </span><span class="s0">if </span><span class="s1">p </span><span class="s2">&lt; </span><span class="s6">0.05 </span><span class="s0">else </span><span class="s4">'gray' </span><span class="s0">for </span><span class="s1">p </span><span class="s0">in </span><span class="s1">measure_df</span><span class="s2">[</span><span class="s4">'p_value'</span><span class="s2">]]</span>
                <span class="s1">plt</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span>
                    <span class="s1">x</span><span class="s2">=</span><span class="s1">measure_df</span><span class="s2">[</span><span class="s4">'coefficient'</span><span class="s2">],</span>
                    <span class="s1">y</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">measure_df</span><span class="s2">)),</span>
                    <span class="s1">fmt</span><span class="s2">=</span><span class="s4">'o'</span><span class="s2">,</span>
                    <span class="s1">markersize</span><span class="s2">=</span><span class="s6">8</span><span class="s2">,</span>
                    <span class="s1">color</span><span class="s2">=</span><span class="s1">colors</span>
                <span class="s2">)</span>
                <span class="s1">plt</span><span class="s2">.</span><span class="s1">yticks</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">measure_df</span><span class="s2">)),</span>
                           <span class="s2">[</span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">row</span><span class="s2">[</span><span class="s4">'test_type'</span><span class="s2">]</span><span class="s0">} {</span><span class="s1">row</span><span class="s2">[</span><span class="s4">'parameter'</span><span class="s2">]</span><span class="s0">}</span><span class="s4">&quot; </span><span class="s0">for </span><span class="s1">_</span><span class="s2">, </span><span class="s1">row </span><span class="s0">in </span><span class="s1">measure_df</span><span class="s2">.</span><span class="s1">iterrows</span><span class="s2">()])</span>
                <span class="s1">plt</span><span class="s2">.</span><span class="s1">axvline</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'black'</span><span class="s2">, </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s4">'--'</span><span class="s2">)</span>
                <span class="s1">plt</span><span class="s2">.</span><span class="s1">title</span><span class="s2">(</span><span class="s4">f'Mixed Effects Model Coefficients - </span><span class="s0">{</span><span class="s1">cd_measure</span><span class="s0">}</span><span class="s4">'</span><span class="s2">)</span>
                <span class="s1">plt</span><span class="s2">.</span><span class="s1">xlabel</span><span class="s2">(</span><span class="s4">'Coefficient'</span><span class="s2">)</span>
                <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>
                <span class="s1">plt</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">output_dir</span><span class="s2">, </span><span class="s4">f'mixed_effects_forest_plot_</span><span class="s0">{</span><span class="s1">cd_measure</span><span class="s0">}</span><span class="s4">.png'</span><span class="s2">))</span>
                <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;Skipping mixed effects forest plot: all coefficients are NaN.&quot;</span><span class="s2">)</span>

    <span class="s3"># Gender comparison for balance parameters</span>
    <span class="s0">for </span><span class="s1">test_type</span><span class="s2">, </span><span class="s1">params </span><span class="s0">in </span><span class="s2">[(</span><span class="s4">'ITUG'</span><span class="s2">, </span><span class="s1">itug_params</span><span class="s2">), (</span><span class="s4">'ISWAY'</span><span class="s2">, </span><span class="s1">isway_params</span><span class="s2">)]:</span>
        <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">params</span><span class="s2">:</span>
            <span class="s1">pre_column </span><span class="s2">= </span><span class="s4">f'pre_</span><span class="s0">{</span><span class="s1">test_type</span><span class="s2">.</span><span class="s1">lower</span><span class="s2">()</span><span class="s0">}</span><span class="s4">_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">10</span><span class="s2">, </span><span class="s6">6</span><span class="s2">))</span>
            <span class="s1">sns</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=</span><span class="s4">'gender'</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s1">pre_column</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">df</span><span class="s2">)</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">title</span><span class="s2">(</span><span class="s4">f'</span><span class="s0">{</span><span class="s1">test_type</span><span class="s0">} {</span><span class="s1">param</span><span class="s0">} </span><span class="s4">by Gender'</span><span class="s2">)</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">output_dir</span><span class="s2">, </span><span class="s4">f'</span><span class="s0">{</span><span class="s1">test_type</span><span class="s0">}</span><span class="s4">_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">_gender_comparison.png'</span><span class="s2">))</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>

    <span class="s3"># Age vs Balance Parameters</span>
    <span class="s0">for </span><span class="s1">test_type</span><span class="s2">, </span><span class="s1">params </span><span class="s0">in </span><span class="s2">[(</span><span class="s4">'ITUG'</span><span class="s2">, </span><span class="s1">itug_params</span><span class="s2">), (</span><span class="s4">'ISWAY'</span><span class="s2">, </span><span class="s1">isway_params</span><span class="s2">)]:</span>
        <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">params</span><span class="s2">:</span>
            <span class="s1">pre_column </span><span class="s2">= </span><span class="s4">f'pre_</span><span class="s0">{</span><span class="s1">test_type</span><span class="s2">.</span><span class="s1">lower</span><span class="s2">()</span><span class="s0">}</span><span class="s4">_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">10</span><span class="s2">, </span><span class="s6">6</span><span class="s2">))</span>
            <span class="s1">sns</span><span class="s2">.</span><span class="s1">scatterplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=</span><span class="s4">'age'</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s1">pre_column</span><span class="s2">, </span><span class="s1">hue</span><span class="s2">=</span><span class="s4">'gender'</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">df</span><span class="s2">)</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">title</span><span class="s2">(</span><span class="s4">f'Age vs </span><span class="s0">{</span><span class="s1">test_type</span><span class="s0">} {</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">)</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">output_dir</span><span class="s2">, </span><span class="s4">f'age_vs_</span><span class="s0">{</span><span class="s1">test_type</span><span class="s0">}</span><span class="s4">_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">.png'</span><span class="s2">))</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>

    <span class="s3"># Rating change histograms</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">10</span><span class="s2">, </span><span class="s6">6</span><span class="s2">))</span>
    <span class="s1">sns</span><span class="s2">.</span><span class="s1">histplot</span><span class="s2">(</span><span class="s1">df</span><span class="s2">[</span><span class="s4">'average_rating_change'</span><span class="s2">], </span><span class="s1">kde</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">title</span><span class="s2">(</span><span class="s4">'Distribution of Rating Changes'</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">xlabel</span><span class="s2">(</span><span class="s4">'Absolute Rating Change'</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">output_dir</span><span class="s2">, </span><span class="s4">'rating_change_distribution.png'</span><span class="s2">))</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>

    <span class="s3"># Correlation between balance changes and rating changes</span>
    <span class="s1">change_score_df </span><span class="s2">= </span><span class="s1">results</span><span class="s2">[</span><span class="s4">'change_score'</span><span class="s2">]</span>
    <span class="s0">if not </span><span class="s1">change_score_df</span><span class="s2">[</span><span class="s4">'correlation'</span><span class="s2">].</span><span class="s1">isna</span><span class="s2">().</span><span class="s1">all</span><span class="s2">():</span>
        <span class="s0">for </span><span class="s1">cd_measure </span><span class="s0">in </span><span class="s2">[</span><span class="s4">'average_rating_change'</span><span class="s2">, </span><span class="s4">'average_rejected_difference'</span><span class="s2">, </span><span class="s4">'chosen_pair_rating_diff'</span><span class="s2">]:</span>
            <span class="s1">measure_df </span><span class="s2">= </span><span class="s1">change_score_df</span><span class="s2">[</span><span class="s1">change_score_df</span><span class="s2">[</span><span class="s4">'cd_measure'</span><span class="s2">] == </span><span class="s1">cd_measure</span><span class="s2">]</span>
            <span class="s0">if not </span><span class="s1">measure_df</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">:</span>
                <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">10</span><span class="s2">, </span><span class="s6">8</span><span class="s2">))</span>
                <span class="s1">pivot_data </span><span class="s2">= </span><span class="s1">measure_df</span><span class="s2">.</span><span class="s1">pivot_table</span><span class="s2">(</span>
                    <span class="s1">index</span><span class="s2">=[</span><span class="s4">'test_type'</span><span class="s2">, </span><span class="s4">'parameter'</span><span class="s2">],</span>
                    <span class="s1">values</span><span class="s2">=</span><span class="s4">'correlation'</span>
                <span class="s2">)</span>
                <span class="s1">sns</span><span class="s2">.</span><span class="s1">heatmap</span><span class="s2">(</span><span class="s1">pivot_data</span><span class="s2">, </span><span class="s1">annot</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s4">'coolwarm'</span><span class="s2">, </span><span class="s1">center</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">vmin</span><span class="s2">=-</span><span class="s6">1</span><span class="s2">, </span><span class="s1">vmax</span><span class="s2">=</span><span class="s6">1</span><span class="s2">)</span>
                <span class="s1">plt</span><span class="s2">.</span><span class="s1">title</span><span class="s2">(</span><span class="s4">f'Balance Change to </span><span class="s0">{</span><span class="s1">cd_measure</span><span class="s0">} </span><span class="s4">Correlation'</span><span class="s2">)</span>
                <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>
                <span class="s1">plt</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">output_dir</span><span class="s2">, </span><span class="s4">f'change_correlation_</span><span class="s0">{</span><span class="s1">cd_measure</span><span class="s0">}</span><span class="s4">.png'</span><span class="s2">))</span>
                <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>

    <span class="s3"># Summary statistics for all variables</span>
    <span class="s1">summary_stats </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">describe</span><span class="s2">()</span>
    <span class="s1">summary_stats</span><span class="s2">.</span><span class="s1">to_csv</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">output_dir</span><span class="s2">, </span><span class="s4">'summary_statistics.csv'</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">main</span><span class="s2">(</span><span class="s1">base_dir</span><span class="s2">, </span><span class="s1">output_dir</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot; 
    Main function to run all analyses. 
 
    Args: 
        base_dir: Base directory containing sensor_analysis folder 
        output_dir: Directory to save analysis results 
    &quot;&quot;&quot;</span>
    <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Loading data from </span><span class="s0">{</span><span class="s1">base_dir</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">load_data</span><span class="s2">(</span><span class="s1">base_dir</span><span class="s2">)</span>

    <span class="s3"># Generate demographic summary</span>
    <span class="s1">demo_summary </span><span class="s2">= </span><span class="s1">demographic_summary</span><span class="s2">(</span><span class="s1">df</span><span class="s2">)</span>

    <span class="s3"># Calculate balance changes</span>
    <span class="s1">balance_changes </span><span class="s2">= </span><span class="s1">calculate_balance_changes</span><span class="s2">(</span><span class="s1">df</span><span class="s2">)</span>

    <span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
    <span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
    <span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">pyplot </span><span class="s0">as </span><span class="s1">plt</span>
    <span class="s0">import </span><span class="s1">seaborn </span><span class="s0">as </span><span class="s1">sns</span>
    <span class="s0">from </span><span class="s1">scipy </span><span class="s0">import </span><span class="s1">stats</span>
    <span class="s0">import </span><span class="s1">json</span>
    <span class="s0">import </span><span class="s1">statsmodels</span><span class="s2">.</span><span class="s1">api </span><span class="s0">as </span><span class="s1">sm</span>
    <span class="s0">from </span><span class="s1">statsmodels</span><span class="s2">.</span><span class="s1">formula</span><span class="s2">.</span><span class="s1">api </span><span class="s0">import </span><span class="s1">ols</span>
    <span class="s0">import </span><span class="s1">pingouin </span><span class="s0">as </span><span class="s1">pg</span>
    <span class="s0">from </span><span class="s1">statsmodels</span><span class="s2">.</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">anova </span><span class="s0">import </span><span class="s1">AnovaRM</span>
    <span class="s0">import </span><span class="s1">statsmodels</span><span class="s2">.</span><span class="s1">formula</span><span class="s2">.</span><span class="s1">api </span><span class="s0">as </span><span class="s1">smf</span>
    <span class="s0">import </span><span class="s1">os</span>
    <span class="s0">from </span><span class="s1">itertools </span><span class="s0">import </span><span class="s1">combinations</span>
    <span class="s0">import </span><span class="s1">glob</span>

    <span class="s3"># Function to load data from participant_summary.json files</span>
    <span class="s0">def </span><span class="s1">load_data</span><span class="s2">(</span><span class="s1">base_dir</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot; 
        Reads participant_summary.json files for each participant and converts to a DataFrame 
 
        Parameters: 
        ----------- 
        base_dir : str 
            Base directory containing 'sensor_analysis' folder with participant data 
 
        Returns: 
        -------- 
        pd.DataFrame 
            Combined DataFrame with all participant data 
        &quot;&quot;&quot;</span>
        <span class="s1">sensor_dir </span><span class="s2">= </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">base_dir</span><span class="s2">, </span><span class="s4">&quot;sensor_analysis&quot;</span><span class="s2">)</span>

        <span class="s1">df_list </span><span class="s2">= []</span>

        <span class="s3"># Find all participant directories in sensor_analysis</span>
        <span class="s1">participant_dirs </span><span class="s2">= </span><span class="s1">glob</span><span class="s2">.</span><span class="s1">glob</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">sensor_dir</span><span class="s2">, </span><span class="s4">&quot;*-*-*-*-*&quot;</span><span class="s2">))</span>

        <span class="s0">for </span><span class="s1">participant_dir </span><span class="s0">in </span><span class="s1">participant_dirs</span><span class="s2">:</span>
            <span class="s3"># Load the participant summary JSON file</span>
            <span class="s1">summary_path </span><span class="s2">= </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">participant_dir</span><span class="s2">, </span><span class="s4">&quot;participant_summary.json&quot;</span><span class="s2">)</span>

            <span class="s0">if </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">exists</span><span class="s2">(</span><span class="s1">summary_path</span><span class="s2">):</span>
                <span class="s0">try</span><span class="s2">:</span>
                    <span class="s0">with </span><span class="s1">open</span><span class="s2">(</span><span class="s1">summary_path</span><span class="s2">, </span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">encoding</span><span class="s2">=</span><span class="s4">'utf-8'</span><span class="s2">) </span><span class="s0">as </span><span class="s1">f</span><span class="s2">:</span>
                        <span class="s1">participant_data </span><span class="s2">= </span><span class="s1">json</span><span class="s2">.</span><span class="s1">load</span><span class="s2">(</span><span class="s1">f</span><span class="s2">)</span>

                    <span class="s3"># Extract all data from the participant summary</span>
                    <span class="s1">person_df </span><span class="s2">= {</span>
                        <span class="s4">'name'</span><span class="s2">: </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'name'</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
                        <span class="s4">'gender'</span><span class="s2">: </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'gender'</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
                        <span class="s4">'gender_code'</span><span class="s2">: </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'gender_code'</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
                        <span class="s4">'age'</span><span class="s2">: </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'age'</span><span class="s2">, </span><span class="s6">0</span><span class="s2">),</span>
                        <span class="s4">'weight'</span><span class="s2">: </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'weight'</span><span class="s2">, </span><span class="s6">0</span><span class="s2">),</span>
                        <span class="s4">'height'</span><span class="s2">: </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'height'</span><span class="s2">, </span><span class="s6">0</span><span class="s2">),</span>
                        <span class="s4">'bmi'</span><span class="s2">: </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'bmi'</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>
                    <span class="s2">}</span>

                    <span class="s3"># Extract pre-ITUG metrics</span>
                    <span class="s1">pre_itug </span><span class="s2">= </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'pre_itug_metrics'</span><span class="s2">, {})</span>
                    <span class="s0">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value </span><span class="s0">in </span><span class="s1">pre_itug</span><span class="s2">.</span><span class="s1">items</span><span class="s2">():</span>
                        <span class="s0">if </span><span class="s1">key </span><span class="s0">not in </span><span class="s2">[</span><span class="s4">'test_type'</span><span class="s2">, </span><span class="s4">'valid'</span><span class="s2">]:  </span><span class="s3"># Skip non-numeric fields</span>
                            <span class="s1">person_df</span><span class="s2">[</span><span class="s4">f'pre_itug_</span><span class="s0">{</span><span class="s1">key</span><span class="s0">}</span><span class="s4">'</span><span class="s2">] = </span><span class="s1">value</span>

                    <span class="s3"># Extract post-ITUG metrics</span>
                    <span class="s1">post_itug </span><span class="s2">= </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'post_itug_metrics'</span><span class="s2">, {})</span>
                    <span class="s0">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value </span><span class="s0">in </span><span class="s1">post_itug</span><span class="s2">.</span><span class="s1">items</span><span class="s2">():</span>
                        <span class="s0">if </span><span class="s1">key </span><span class="s0">not in </span><span class="s2">[</span><span class="s4">'test_type'</span><span class="s2">, </span><span class="s4">'valid'</span><span class="s2">]:  </span><span class="s3"># Skip non-numeric fields</span>
                            <span class="s1">person_df</span><span class="s2">[</span><span class="s4">f'post_itug_</span><span class="s0">{</span><span class="s1">key</span><span class="s0">}</span><span class="s4">'</span><span class="s2">] = </span><span class="s1">value</span>

                    <span class="s3"># Extract pre-ISWAY metrics</span>
                    <span class="s1">pre_isway </span><span class="s2">= </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'pre_isway_metrics'</span><span class="s2">, {})</span>
                    <span class="s0">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value </span><span class="s0">in </span><span class="s1">pre_isway</span><span class="s2">.</span><span class="s1">items</span><span class="s2">():</span>
                        <span class="s0">if </span><span class="s1">key </span><span class="s0">not in </span><span class="s2">[</span><span class="s4">'test_type'</span><span class="s2">, </span><span class="s4">'valid'</span><span class="s2">]:  </span><span class="s3"># Skip non-numeric fields</span>
                            <span class="s1">person_df</span><span class="s2">[</span><span class="s4">f'pre_isway_</span><span class="s0">{</span><span class="s1">key</span><span class="s0">}</span><span class="s4">'</span><span class="s2">] = </span><span class="s1">value</span>

                    <span class="s3"># Extract post-ISWAY metrics</span>
                    <span class="s1">post_isway </span><span class="s2">= </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'post_isway_metrics'</span><span class="s2">, {})</span>
                    <span class="s0">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value </span><span class="s0">in </span><span class="s1">post_isway</span><span class="s2">.</span><span class="s1">items</span><span class="s2">():</span>
                        <span class="s0">if </span><span class="s1">key </span><span class="s0">not in </span><span class="s2">[</span><span class="s4">'test_type'</span><span class="s2">, </span><span class="s4">'valid'</span><span class="s2">]:  </span><span class="s3"># Skip non-numeric fields</span>
                            <span class="s1">person_df</span><span class="s2">[</span><span class="s4">f'post_isway_</span><span class="s0">{</span><span class="s1">key</span><span class="s0">}</span><span class="s4">'</span><span class="s2">] = </span><span class="s1">value</span>

                    <span class="s3"># Extract food/cognitive dissonance metrics</span>
                    <span class="s1">person_df</span><span class="s2">[</span><span class="s4">'initial_rating'</span><span class="s2">] = </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'initial_rating'</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>
                    <span class="s1">person_df</span><span class="s2">[</span><span class="s4">'final_rating'</span><span class="s2">] = </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'final_rating'</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>
                    <span class="s1">person_df</span><span class="s2">[</span><span class="s4">'rejected_pair_rating_diff'</span><span class="s2">] = </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'rejected_pair_rating_diff'</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>
                    <span class="s1">person_df</span><span class="s2">[</span><span class="s4">'chosen_pair_rating_diff'</span><span class="s2">] = </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'chosen_pair_rating_diff'</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>
                    <span class="s1">person_df</span><span class="s2">[</span><span class="s4">'computer_pair_rating_diff'</span><span class="s2">] = </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'computer_pair_rating_diff'</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>
                    <span class="s1">person_df</span><span class="s2">[</span><span class="s4">'timeout_count'</span><span class="s2">] = </span><span class="s1">participant_data</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'timeout_count'</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>

                    <span class="s3"># Calculate cognitive dissonance measures</span>
                    <span class="s1">person_df</span><span class="s2">[</span><span class="s4">'average_rating_change'</span><span class="s2">] = </span><span class="s1">abs</span><span class="s2">(</span><span class="s1">person_df</span><span class="s2">[</span><span class="s4">'final_rating'</span><span class="s2">] - </span><span class="s1">person_df</span><span class="s2">[</span><span class="s4">'initial_rating'</span><span class="s2">])</span>
                    <span class="s1">person_df</span><span class="s2">[</span><span class="s4">'average_rejected_rating_difference'</span><span class="s2">] = </span><span class="s1">abs</span><span class="s2">(</span><span class="s1">person_df</span><span class="s2">[</span><span class="s4">'rejected_pair_rating_diff'</span><span class="s2">])</span>

                    <span class="s1">df_list</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">person_df</span><span class="s2">)</span>
                    <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Loaded data for participant: </span><span class="s0">{</span><span class="s1">person_df</span><span class="s2">[</span><span class="s4">'name'</span><span class="s2">]</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

                <span class="s0">except </span><span class="s1">Exception </span><span class="s0">as </span><span class="s1">e</span><span class="s2">:</span>
                    <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Error loading data for </span><span class="s0">{</span><span class="s1">participant_dir</span><span class="s0">}</span><span class="s4">: </span><span class="s0">{</span><span class="s1">e</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

        <span class="s3"># Combine all person data into a single DataFrame</span>
        <span class="s0">if </span><span class="s1">df_list</span><span class="s2">:</span>
            <span class="s1">df </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">df_list</span><span class="s2">)</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Successfully loaded data for </span><span class="s0">{</span><span class="s1">len</span><span class="s2">(</span><span class="s1">df</span><span class="s2">)</span><span class="s0">} </span><span class="s4">participants&quot;</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s1">df</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;No valid participant data found!&quot;</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">()</span>

    <span class="s3"># Function to calculate balance change scores</span>
    <span class="s0">def </span><span class="s1">calculate_balance_changes</span><span class="s2">(</span><span class="s1">df</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot; 
        Calculate changes in balance parameters between pre and post tests 
        &quot;&quot;&quot;</span>
        <span class="s1">balance_changes </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">()</span>
        <span class="s1">balance_changes</span><span class="s2">[</span><span class="s4">'name'</span><span class="s2">] = </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'name'</span><span class="s2">]</span>

        <span class="s3"># Calculate ITUG changes</span>
        <span class="s1">itug_params </span><span class="s2">= [</span><span class="s4">'PC1_std'</span><span class="s2">, </span><span class="s4">'PC1_range'</span><span class="s2">, </span><span class="s4">'PC1_dominant_freq'</span><span class="s2">, </span><span class="s4">'PC1_spectral_entropy'</span><span class="s2">, </span><span class="s4">'stride_frequency'</span><span class="s2">]</span>
        <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">itug_params</span><span class="s2">:</span>
            <span class="s1">balance_changes</span><span class="s2">[</span><span class="s4">f'itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">_change'</span><span class="s2">] = </span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'post_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">] - </span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'pre_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">]</span>

        <span class="s3"># Calculate ISWAY changes</span>
        <span class="s1">isway_params </span><span class="s2">= [</span><span class="s4">'PC1_std'</span><span class="s2">, </span><span class="s4">'PC1_range'</span><span class="s2">, </span><span class="s4">'PC1_dominant_freq'</span><span class="s2">, </span><span class="s4">'PC1_spectral_entropy'</span><span class="s2">, </span><span class="s4">'sway_area'</span><span class="s2">,</span>
                        <span class="s4">'mean_distance'</span><span class="s2">,</span>
                        <span class="s4">'path_length'</span><span class="s2">]</span>
        <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">isway_params</span><span class="s2">:</span>
            <span class="s1">balance_changes</span><span class="s2">[</span><span class="s4">f'isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">_change'</span><span class="s2">] = </span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'post_isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">] - </span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'pre_isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">]</span>

        <span class="s3"># Add cognitive dissonance measures for analysis</span>
        <span class="s1">balance_changes</span><span class="s2">[</span><span class="s4">'average_rating_change'</span><span class="s2">] = </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'average_rating_change'</span><span class="s2">]</span>
        <span class="s1">balance_changes</span><span class="s2">[</span><span class="s4">'average_rejected_rating_difference'</span><span class="s2">] = </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'average_rejected_rating_difference'</span><span class="s2">]</span>
        <span class="s1">balance_changes</span><span class="s2">[</span><span class="s4">'chosen_pair_rating_diff'</span><span class="s2">] = </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'chosen_pair_rating_diff'</span><span class="s2">]</span>
        <span class="s1">balance_changes</span><span class="s2">[</span><span class="s4">'computer_pair_rating_diff'</span><span class="s2">] = </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'computer_pair_rating_diff'</span><span class="s2">]</span>

        <span class="s3"># Add demographic information for potential subgroup analysis</span>
        <span class="s1">balance_changes</span><span class="s2">[</span><span class="s4">'gender'</span><span class="s2">] = </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'gender'</span><span class="s2">]</span>
        <span class="s1">balance_changes</span><span class="s2">[</span><span class="s4">'age'</span><span class="s2">] = </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'age'</span><span class="s2">]</span>
        <span class="s1">balance_changes</span><span class="s2">[</span><span class="s4">'bmi'</span><span class="s2">] = </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'bmi'</span><span class="s2">]</span>

        <span class="s0">return </span><span class="s1">balance_changes</span>

    <span class="s3"># Function for correlation analysis</span>
    <span class="s0">def </span><span class="s1">correlation_analysis</span><span class="s2">(</span><span class="s1">df</span><span class="s2">, </span><span class="s1">balance_changes</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot; 
        Perform correlation analysis between initial balance measures and cognitive dissonance 
        &quot;&quot;&quot;</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">=== CORRELATION ANALYSIS ===</span><span class="s0">\n</span><span class="s4">&quot;</span><span class="s2">)</span>

        <span class="s3"># Define balance parameters to analyze</span>
        <span class="s1">itug_params </span><span class="s2">= [</span><span class="s4">'PC1_std'</span><span class="s2">, </span><span class="s4">'PC1_range'</span><span class="s2">, </span><span class="s4">'PC1_spectral_entropy'</span><span class="s2">, </span><span class="s4">'stride_frequency'</span><span class="s2">]</span>
        <span class="s1">isway_params </span><span class="s2">= [</span><span class="s4">'PC1_std'</span><span class="s2">, </span><span class="s4">'PC1_range'</span><span class="s2">, </span><span class="s4">'PC1_spectral_entropy'</span><span class="s2">, </span><span class="s4">'sway_area'</span><span class="s2">, </span><span class="s4">'mean_distance'</span><span class="s2">, </span><span class="s4">'path_length'</span><span class="s2">]</span>

        <span class="s3"># Initialize results dictionary</span>
        <span class="s1">correlation_results </span><span class="s2">= {</span>
            <span class="s4">'test_type'</span><span class="s2">: [],</span>
            <span class="s4">'parameter'</span><span class="s2">: [],</span>
            <span class="s4">'correlation_with_rating_change'</span><span class="s2">: [],</span>
            <span class="s4">'p_value_rating_change'</span><span class="s2">: [],</span>
            <span class="s4">'correlation_with_rejected_diff'</span><span class="s2">: [],</span>
            <span class="s4">'p_value_rejected_diff'</span><span class="s2">: []</span>
        <span class="s2">}</span>

        <span class="s3"># Correlations for ITUG measures</span>
        <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">itug_params</span><span class="s2">:</span>
            <span class="s0">try</span><span class="s2">:</span>
                <span class="s3"># Correlation with average rating change</span>
                <span class="s1">corr_rating</span><span class="s2">, </span><span class="s1">p_rating </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">pearsonr</span><span class="s2">(</span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'pre_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">], </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'average_rating_change'</span><span class="s2">])</span>

                <span class="s3"># Correlation with rejected rating difference</span>
                <span class="s1">corr_rejected</span><span class="s2">, </span><span class="s1">p_rejected </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">pearsonr</span><span class="s2">(</span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'pre_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">],</span>
                                                           <span class="s1">df</span><span class="s2">[</span><span class="s4">'average_rejected_rating_difference'</span><span class="s2">])</span>

                <span class="s3"># Store results</span>
                <span class="s1">correlation_results</span><span class="s2">[</span><span class="s4">'test_type'</span><span class="s2">].</span><span class="s1">append</span><span class="s2">(</span><span class="s4">'ITUG'</span><span class="s2">)</span>
                <span class="s1">correlation_results</span><span class="s2">[</span><span class="s4">'parameter'</span><span class="s2">].</span><span class="s1">append</span><span class="s2">(</span><span class="s1">param</span><span class="s2">)</span>
                <span class="s1">correlation_results</span><span class="s2">[</span><span class="s4">'correlation_with_rating_change'</span><span class="s2">].</span><span class="s1">append</span><span class="s2">(</span><span class="s1">corr_rating</span><span class="s2">)</span>
                <span class="s1">correlation_results</span><span class="s2">[</span><span class="s4">'p_value_rating_change'</span><span class="s2">].</span><span class="s1">append</span><span class="s2">(</span><span class="s1">p_rating</span><span class="s2">)</span>
                <span class="s1">correlation_results</span><span class="s2">[</span><span class="s4">'correlation_with_rejected_diff'</span><span class="s2">].</span><span class="s1">append</span><span class="s2">(</span><span class="s1">corr_rejected</span><span class="s2">)</span>
                <span class="s1">correlation_results</span><span class="s2">[</span><span class="s4">'p_value_rejected_diff'</span><span class="s2">].</span><span class="s1">append</span><span class="s2">(</span><span class="s1">p_rejected</span><span class="s2">)</span>
            <span class="s0">except </span><span class="s1">Exception </span><span class="s0">as </span><span class="s1">e</span><span class="s2">:</span>
                <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Error in correlation analysis for ITUG </span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">: </span><span class="s0">{</span><span class="s1">e</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

        <span class="s3"># Correlations for ISWAY measures</span>
        <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">isway_params</span><span class="s2">:</span>
            <span class="s0">try</span><span class="s2">:</span>
                <span class="s3"># Correlation with average rating change</span>
                <span class="s1">corr_rating</span><span class="s2">, </span><span class="s1">p_rating </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">pearsonr</span><span class="s2">(</span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'pre_isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">], </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'average_rating_change'</span><span class="s2">])</span>

                <span class="s3"># Correlation with rejected rating difference</span>
                <span class="s1">corr_rejected</span><span class="s2">, </span><span class="s1">p_rejected </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">pearsonr</span><span class="s2">(</span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'pre_isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">],</span>
                                                           <span class="s1">df</span><span class="s2">[</span><span class="s4">'average_rejected_rating_difference'</span><span class="s2">])</span>

                <span class="s3"># Store results</span>
                <span class="s1">correlation_results</span><span class="s2">[</span><span class="s4">'test_type'</span><span class="s2">].</span><span class="s1">append</span><span class="s2">(</span><span class="s4">'ISWAY'</span><span class="s2">)</span>
                <span class="s1">correlation_results</span><span class="s2">[</span><span class="s4">'parameter'</span><span class="s2">].</span><span class="s1">append</span><span class="s2">(</span><span class="s1">param</span><span class="s2">)</span>
                <span class="s1">correlation_results</span><span class="s2">[</span><span class="s4">'correlation_with_rating_change'</span><span class="s2">].</span><span class="s1">append</span><span class="s2">(</span><span class="s1">corr_rating</span><span class="s2">)</span>
                <span class="s1">correlation_results</span><span class="s2">[</span><span class="s4">'p_value_rating_change'</span><span class="s2">].</span><span class="s1">append</span><span class="s2">(</span><span class="s1">p_rating</span><span class="s2">)</span>
                <span class="s1">correlation_results</span><span class="s2">[</span><span class="s4">'correlation_with_rejected_diff'</span><span class="s2">].</span><span class="s1">append</span><span class="s2">(</span><span class="s1">corr_rejected</span><span class="s2">)</span>
                <span class="s1">correlation_results</span><span class="s2">[</span><span class="s4">'p_value_rejected_diff'</span><span class="s2">].</span><span class="s1">append</span><span class="s2">(</span><span class="s1">p_rejected</span><span class="s2">)</span>
            <span class="s0">except </span><span class="s1">Exception </span><span class="s0">as </span><span class="s1">e</span><span class="s2">:</span>
                <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Error in correlation analysis for ISWAY </span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">: </span><span class="s0">{</span><span class="s1">e</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

        <span class="s3"># Convert to DataFrame</span>
        <span class="s1">corr_df </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">correlation_results</span><span class="s2">)</span>

        <span class="s3"># Add significance indicators</span>
        <span class="s1">corr_df</span><span class="s2">[</span><span class="s4">'sig_rating_change'</span><span class="s2">] = </span><span class="s1">corr_df</span><span class="s2">[</span><span class="s4">'p_value_rating_change'</span><span class="s2">].</span><span class="s1">apply</span><span class="s2">(</span>
            <span class="s0">lambda </span><span class="s1">p</span><span class="s2">: </span><span class="s4">'***' </span><span class="s0">if </span><span class="s1">p </span><span class="s2">&lt; </span><span class="s6">0.001 </span><span class="s0">else </span><span class="s2">(</span><span class="s4">'**' </span><span class="s0">if </span><span class="s1">p </span><span class="s2">&lt; </span><span class="s6">0.01 </span><span class="s0">else </span><span class="s2">(</span><span class="s4">'*' </span><span class="s0">if </span><span class="s1">p </span><span class="s2">&lt; </span><span class="s6">0.05 </span><span class="s0">else </span><span class="s4">'ns'</span><span class="s2">))</span>
        <span class="s2">)</span>
        <span class="s1">corr_df</span><span class="s2">[</span><span class="s4">'sig_rejected_diff'</span><span class="s2">] = </span><span class="s1">corr_df</span><span class="s2">[</span><span class="s4">'p_value_rejected_diff'</span><span class="s2">].</span><span class="s1">apply</span><span class="s2">(</span>
            <span class="s0">lambda </span><span class="s1">p</span><span class="s2">: </span><span class="s4">'***' </span><span class="s0">if </span><span class="s1">p </span><span class="s2">&lt; </span><span class="s6">0.001 </span><span class="s0">else </span><span class="s2">(</span><span class="s4">'**' </span><span class="s0">if </span><span class="s1">p </span><span class="s2">&lt; </span><span class="s6">0.01 </span><span class="s0">else </span><span class="s2">(</span><span class="s4">'*' </span><span class="s0">if </span><span class="s1">p </span><span class="s2">&lt; </span><span class="s6">0.05 </span><span class="s0">else </span><span class="s4">'ns'</span><span class="s2">))</span>
        <span class="s2">)</span>

        <span class="s1">print</span><span class="s2">(</span><span class="s1">corr_df</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">corr_df</span>

    <span class="s3"># Function for linear regression analysis</span>
    <span class="s0">def </span><span class="s1">linear_regression_analysis</span><span class="s2">(</span><span class="s1">df</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot; 
        Perform linear regression to predict cognitive dissonance from balance parameters 
        &quot;&quot;&quot;</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">=== LINEAR REGRESSION ANALYSIS ===</span><span class="s0">\n</span><span class="s4">&quot;</span><span class="s2">)</span>

        <span class="s3"># Define dependent variables (cognitive dissonance measures)</span>
        <span class="s1">dependent_vars </span><span class="s2">= [</span><span class="s4">'average_rating_change'</span><span class="s2">, </span><span class="s4">'average_rejected_rating_difference'</span><span class="s2">]</span>

        <span class="s3"># Define independent variables (balance parameters)</span>
        <span class="s1">itug_predictors </span><span class="s2">= [</span><span class="s4">'pre_itug_PC1_std'</span><span class="s2">, </span><span class="s4">'pre_itug_PC1_range'</span><span class="s2">, </span><span class="s4">'pre_itug_PC1_spectral_entropy'</span><span class="s2">,</span>
                           <span class="s4">'pre_itug_stride_frequency'</span><span class="s2">]</span>
        <span class="s1">isway_predictors </span><span class="s2">= [</span><span class="s4">'pre_isway_PC1_std'</span><span class="s2">, </span><span class="s4">'pre_isway_PC1_range'</span><span class="s2">, </span><span class="s4">'pre_isway_PC1_spectral_entropy'</span><span class="s2">,</span>
                            <span class="s4">'pre_isway_sway_area'</span><span class="s2">, </span><span class="s4">'pre_isway_mean_distance'</span><span class="s2">, </span><span class="s4">'pre_isway_path_length'</span><span class="s2">]</span>

        <span class="s1">regression_results </span><span class="s2">= []</span>

        <span class="s3"># Run regressions for each combination of dependent variable and test type</span>
        <span class="s0">for </span><span class="s1">dep_var </span><span class="s0">in </span><span class="s1">dependent_vars</span><span class="s2">:</span>
            <span class="s3"># ITUG regression</span>
            <span class="s0">try</span><span class="s2">:</span>
                <span class="s1">itug_formula </span><span class="s2">= </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">dep_var</span><span class="s0">} </span><span class="s4">~ </span><span class="s0">{</span><span class="s4">' + '</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">itug_predictors</span><span class="s2">)</span><span class="s0">}</span><span class="s4">&quot;</span>
                <span class="s1">itug_model </span><span class="s2">= </span><span class="s1">ols</span><span class="s2">(</span><span class="s1">itug_formula</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">df</span><span class="s2">).</span><span class="s1">fit</span><span class="s2">()</span>

                <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;</span><span class="s0">\n</span><span class="s4">Regression for </span><span class="s0">{</span><span class="s1">dep_var</span><span class="s0">} </span><span class="s4">using ITUG parameters:&quot;</span><span class="s2">)</span>
                <span class="s1">print</span><span class="s2">(</span><span class="s1">itug_model</span><span class="s2">.</span><span class="s1">summary</span><span class="s2">())</span>

                <span class="s3"># Store results</span>
                <span class="s1">itug_result </span><span class="s2">= {</span>
                    <span class="s4">'dependent_variable'</span><span class="s2">: </span><span class="s1">dep_var</span><span class="s2">,</span>
                    <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ITUG'</span><span class="s2">,</span>
                    <span class="s4">'r_squared'</span><span class="s2">: </span><span class="s1">itug_model</span><span class="s2">.</span><span class="s1">rsquared</span><span class="s2">,</span>
                    <span class="s4">'adj_r_squared'</span><span class="s2">: </span><span class="s1">itug_model</span><span class="s2">.</span><span class="s1">rsquared_adj</span><span class="s2">,</span>
                    <span class="s4">'f_statistic'</span><span class="s2">: </span><span class="s1">itug_model</span><span class="s2">.</span><span class="s1">fvalue</span><span class="s2">,</span>
                    <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">itug_model</span><span class="s2">.</span><span class="s1">f_pvalue</span><span class="s2">,</span>
                    <span class="s4">'significant_predictors'</span><span class="s2">: [</span><span class="s1">var </span><span class="s0">for </span><span class="s1">var </span><span class="s0">in </span><span class="s1">itug_predictors </span><span class="s0">if </span><span class="s1">itug_model</span><span class="s2">.</span><span class="s1">pvalues</span><span class="s2">[</span><span class="s1">var</span><span class="s2">] &lt; </span><span class="s6">0.05</span><span class="s2">]</span>
                <span class="s2">}</span>
                <span class="s1">regression_results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">itug_result</span><span class="s2">)</span>
            <span class="s0">except </span><span class="s1">Exception </span><span class="s0">as </span><span class="s1">e</span><span class="s2">:</span>
                <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Error in regression analysis for </span><span class="s0">{</span><span class="s1">dep_var</span><span class="s0">} </span><span class="s4">using ITUG parameters: </span><span class="s0">{</span><span class="s1">e</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

            <span class="s3"># ISWAY regression</span>
            <span class="s0">try</span><span class="s2">:</span>
                <span class="s1">isway_formula </span><span class="s2">= </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">dep_var</span><span class="s0">} </span><span class="s4">~ </span><span class="s0">{</span><span class="s4">' + '</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">isway_predictors</span><span class="s2">)</span><span class="s0">}</span><span class="s4">&quot;</span>
                <span class="s1">isway_model </span><span class="s2">= </span><span class="s1">ols</span><span class="s2">(</span><span class="s1">isway_formula</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">df</span><span class="s2">).</span><span class="s1">fit</span><span class="s2">()</span>

                <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;</span><span class="s0">\n</span><span class="s4">Regression for </span><span class="s0">{</span><span class="s1">dep_var</span><span class="s0">} </span><span class="s4">using ISWAY parameters:&quot;</span><span class="s2">)</span>
                <span class="s1">print</span><span class="s2">(</span><span class="s1">isway_model</span><span class="s2">.</span><span class="s1">summary</span><span class="s2">())</span>

                <span class="s3"># Store results</span>
                <span class="s1">isway_result </span><span class="s2">= {</span>
                    <span class="s4">'dependent_variable'</span><span class="s2">: </span><span class="s1">dep_var</span><span class="s2">,</span>
                    <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ISWAY'</span><span class="s2">,</span>
                    <span class="s4">'r_squared'</span><span class="s2">: </span><span class="s1">isway_model</span><span class="s2">.</span><span class="s1">rsquared</span><span class="s2">,</span>
                    <span class="s4">'adj_r_squared'</span><span class="s2">: </span><span class="s1">isway_model</span><span class="s2">.</span><span class="s1">rsquared_adj</span><span class="s2">,</span>
                    <span class="s4">'f_statistic'</span><span class="s2">: </span><span class="s1">isway_model</span><span class="s2">.</span><span class="s1">fvalue</span><span class="s2">,</span>
                    <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">isway_model</span><span class="s2">.</span><span class="s1">f_pvalue</span><span class="s2">,</span>
                    <span class="s4">'significant_predictors'</span><span class="s2">: [</span><span class="s1">var </span><span class="s0">for </span><span class="s1">var </span><span class="s0">in </span><span class="s1">isway_predictors </span><span class="s0">if </span><span class="s1">isway_model</span><span class="s2">.</span><span class="s1">pvalues</span><span class="s2">[</span><span class="s1">var</span><span class="s2">] &lt; </span><span class="s6">0.05</span><span class="s2">]</span>
                <span class="s2">}</span>
                <span class="s1">regression_results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">isway_result</span><span class="s2">)</span>
            <span class="s0">except </span><span class="s1">Exception </span><span class="s0">as </span><span class="s1">e</span><span class="s2">:</span>
                <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Error in regression analysis for </span><span class="s0">{</span><span class="s1">dep_var</span><span class="s0">} </span><span class="s4">using ISWAY parameters: </span><span class="s0">{</span><span class="s1">e</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

        <span class="s3"># Convert to DataFrame</span>
        <span class="s1">reg_results_df </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">regression_results</span><span class="s2">)</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">Regression Results Summary:&quot;</span><span class="s2">)</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s1">reg_results_df</span><span class="s2">)</span>

        <span class="s0">return </span><span class="s1">reg_results_df</span>

    <span class="s3"># Function for repeated measures ANOVA</span>
    <span class="s0">def </span><span class="s1">repeated_measures_anova</span><span class="s2">(</span><span class="s1">df</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot; 
        Perform repeated measures ANOVA to compare pre and post balance measures 
        &quot;&quot;&quot;</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">=== REPEATED MEASURES ANOVA ===</span><span class="s0">\n</span><span class="s4">&quot;</span><span class="s2">)</span>

        <span class="s3"># Define parameters to analyze</span>
        <span class="s1">itug_params </span><span class="s2">= [</span><span class="s4">'PC1_std'</span><span class="s2">, </span><span class="s4">'PC1_range'</span><span class="s2">, </span><span class="s4">'PC1_spectral_entropy'</span><span class="s2">, </span><span class="s4">'stride_frequency'</span><span class="s2">]</span>
        <span class="s1">isway_params </span><span class="s2">= [</span><span class="s4">'PC1_std'</span><span class="s2">, </span><span class="s4">'PC1_range'</span><span class="s2">, </span><span class="s4">'PC1_spectral_entropy'</span><span class="s2">, </span><span class="s4">'sway_area'</span><span class="s2">, </span><span class="s4">'mean_distance'</span><span class="s2">, </span><span class="s4">'path_length'</span><span class="s2">]</span>

        <span class="s1">anova_results </span><span class="s2">= []</span>

        <span class="s3"># ANOVA for ITUG parameters</span>
        <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">itug_params</span><span class="s2">:</span>
            <span class="s0">try</span><span class="s2">:</span>
                <span class="s3"># Prepare data</span>
                <span class="s1">anova_data </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">({</span>
                    <span class="s4">'subject'</span><span class="s2">: </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'name'</span><span class="s2">],</span>
                    <span class="s4">'pre'</span><span class="s2">: </span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'pre_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">],</span>
                    <span class="s4">'post'</span><span class="s2">: </span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'post_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">]</span>
                <span class="s2">})</span>

                <span class="s3"># Convert to long format</span>
                <span class="s1">anova_data_long </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">melt</span><span class="s2">(</span><span class="s1">anova_data</span><span class="s2">,</span>
                                          <span class="s1">id_vars</span><span class="s2">=[</span><span class="s4">'subject'</span><span class="s2">],</span>
                                          <span class="s1">value_vars</span><span class="s2">=[</span><span class="s4">'pre'</span><span class="s2">, </span><span class="s4">'post'</span><span class="s2">],</span>
                                          <span class="s1">var_name</span><span class="s2">=</span><span class="s4">'time'</span><span class="s2">,</span>
                                          <span class="s1">value_name</span><span class="s2">=</span><span class="s4">'value'</span><span class="s2">)</span>

                <span class="s3"># Run the ANOVA</span>
                <span class="s1">aovrm </span><span class="s2">= </span><span class="s1">AnovaRM</span><span class="s2">(</span><span class="s1">anova_data_long</span><span class="s2">, </span><span class="s4">'value'</span><span class="s2">, </span><span class="s4">'subject'</span><span class="s2">, </span><span class="s1">within</span><span class="s2">=[</span><span class="s4">'time'</span><span class="s2">])</span>
                <span class="s1">res </span><span class="s2">= </span><span class="s1">aovrm</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">()</span>

                <span class="s1">result </span><span class="s2">= {</span>
                    <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ITUG'</span><span class="s2">,</span>
                    <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                    <span class="s4">'F_value'</span><span class="s2">: </span><span class="s1">res</span><span class="s2">.</span><span class="s1">anova_table</span><span class="s2">[</span><span class="s4">'F Value'</span><span class="s2">][</span><span class="s6">0</span><span class="s2">],</span>
                    <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">res</span><span class="s2">.</span><span class="s1">anova_table</span><span class="s2">[</span><span class="s4">'Pr &gt; F'</span><span class="s2">][</span><span class="s6">0</span><span class="s2">],</span>
                    <span class="s4">'significant'</span><span class="s2">: </span><span class="s1">res</span><span class="s2">.</span><span class="s1">anova_table</span><span class="s2">[</span><span class="s4">'Pr &gt; F'</span><span class="s2">][</span><span class="s6">0</span><span class="s2">] &lt; </span><span class="s6">0.05</span>
                <span class="s2">}</span>
                <span class="s1">anova_results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">result</span><span class="s2">)</span>

                <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;</span><span class="s0">\n</span><span class="s4">ANOVA results for ITUG </span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">:&quot;</span><span class="s2">)</span>
                <span class="s1">print</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">anova_table</span><span class="s2">)</span>

            <span class="s0">except </span><span class="s1">Exception </span><span class="s0">as </span><span class="s1">e</span><span class="s2">:</span>
                <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Error running ANOVA for ITUG </span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">: </span><span class="s0">{</span><span class="s1">e</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

        <span class="s3"># ANOVA for ISWAY parameters</span>
        <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">isway_params</span><span class="s2">:</span>
            <span class="s0">try</span><span class="s2">:</span>
                <span class="s3"># Prepare data</span>
                <span class="s1">anova_data </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">({</span>
                    <span class="s4">'subject'</span><span class="s2">: </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'name'</span><span class="s2">],</span>
                    <span class="s4">'pre'</span><span class="s2">: </span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'pre_isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">],</span>
                    <span class="s4">'post'</span><span class="s2">: </span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'post_isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">]</span>
                <span class="s2">})</span>

                <span class="s3"># Convert to long format</span>
                <span class="s1">anova_data_long </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">melt</span><span class="s2">(</span><span class="s1">anova_data</span><span class="s2">,</span>
                                          <span class="s1">id_vars</span><span class="s2">=[</span><span class="s4">'subject'</span><span class="s2">],</span>
                                          <span class="s1">value_vars</span><span class="s2">=[</span><span class="s4">'pre'</span><span class="s2">, </span><span class="s4">'post'</span><span class="s2">],</span>
                                          <span class="s1">var_name</span><span class="s2">=</span><span class="s4">'time'</span><span class="s2">,</span>
                                          <span class="s1">value_name</span><span class="s2">=</span><span class="s4">'value'</span><span class="s2">)</span>

                <span class="s3"># Run the ANOVA</span>
                <span class="s1">aovrm </span><span class="s2">= </span><span class="s1">AnovaRM</span><span class="s2">(</span><span class="s1">anova_data_long</span><span class="s2">, </span><span class="s4">'value'</span><span class="s2">, </span><span class="s4">'subject'</span><span class="s2">, </span><span class="s1">within</span><span class="s2">=[</span><span class="s4">'time'</span><span class="s2">])</span>
                <span class="s1">res </span><span class="s2">= </span><span class="s1">aovrm</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">()</span>

                <span class="s1">result </span><span class="s2">= {</span>
                    <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ISWAY'</span><span class="s2">,</span>
                    <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                    <span class="s4">'F_value'</span><span class="s2">: </span><span class="s1">res</span><span class="s2">.</span><span class="s1">anova_table</span><span class="s2">[</span><span class="s4">'F Value'</span><span class="s2">][</span><span class="s6">0</span><span class="s2">],</span>
                    <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">res</span><span class="s2">.</span><span class="s1">anova_table</span><span class="s2">[</span><span class="s4">'Pr &gt; F'</span><span class="s2">][</span><span class="s6">0</span><span class="s2">],</span>
                    <span class="s4">'significant'</span><span class="s2">: </span><span class="s1">res</span><span class="s2">.</span><span class="s1">anova_table</span><span class="s2">[</span><span class="s4">'Pr &gt; F'</span><span class="s2">][</span><span class="s6">0</span><span class="s2">] &lt; </span><span class="s6">0.05</span>
                <span class="s2">}</span>
                <span class="s1">anova_results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">result</span><span class="s2">)</span>

                <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;</span><span class="s0">\n</span><span class="s4">ANOVA results for ISWAY </span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">:&quot;</span><span class="s2">)</span>
                <span class="s1">print</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">anova_table</span><span class="s2">)</span>

            <span class="s0">except </span><span class="s1">Exception </span><span class="s0">as </span><span class="s1">e</span><span class="s2">:</span>
                <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Error running ANOVA for ISWAY </span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">: </span><span class="s0">{</span><span class="s1">e</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

        <span class="s3"># Convert to DataFrame</span>
        <span class="s1">anova_results_df </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">anova_results</span><span class="s2">)</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">ANOVA Results Summary:&quot;</span><span class="s2">)</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s1">anova_results_df</span><span class="s2">)</span>

        <span class="s0">return </span><span class="s1">anova_results_df</span>

    <span class="s3"># Function for paired t-tests</span>
    <span class="s0">def </span><span class="s1">paired_t_tests</span><span class="s2">(</span><span class="s1">df</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot; 
        Perform paired t-tests to compare pre and post balance measures 
        &quot;&quot;&quot;</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">=== PAIRED T-TESTS ===</span><span class="s0">\n</span><span class="s4">&quot;</span><span class="s2">)</span>

        <span class="s3"># Define parameters to analyze</span>
        <span class="s1">itug_params </span><span class="s2">= [</span><span class="s4">'PC1_std'</span><span class="s2">, </span><span class="s4">'PC1_range'</span><span class="s2">, </span><span class="s4">'PC1_spectral_entropy'</span><span class="s2">, </span><span class="s4">'stride_frequency'</span><span class="s2">]</span>
        <span class="s1">isway_params </span><span class="s2">= [</span><span class="s4">'PC1_std'</span><span class="s2">, </span><span class="s4">'PC1_range'</span><span class="s2">, </span><span class="s4">'PC1_spectral_entropy'</span><span class="s2">, </span><span class="s4">'sway_area'</span><span class="s2">, </span><span class="s4">'mean_distance'</span><span class="s2">, </span><span class="s4">'path_length'</span><span class="s2">]</span>

        <span class="s1">t_test_results </span><span class="s2">= []</span>

        <span class="s3"># T-tests for ITUG parameters</span>
        <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">itug_params</span><span class="s2">:</span>
            <span class="s0">try</span><span class="s2">:</span>
                <span class="s3"># Perform paired t-test</span>
                <span class="s1">t_stat</span><span class="s2">, </span><span class="s1">p_val </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">ttest_rel</span><span class="s2">(</span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'pre_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">], </span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'post_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">])</span>

                <span class="s3"># Calculate Cohen's d effect size</span>
                <span class="s1">mean_diff </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">mean</span><span class="s2">(</span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'post_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">] - </span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'pre_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">])</span>
                <span class="s1">std_diff </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">std</span><span class="s2">(</span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'post_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">] - </span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'pre_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">], </span><span class="s1">ddof</span><span class="s2">=</span><span class="s6">1</span><span class="s2">)</span>
                <span class="s1">cohen_d </span><span class="s2">= </span><span class="s1">mean_diff </span><span class="s2">/ </span><span class="s1">std_diff </span><span class="s0">if </span><span class="s1">std_diff </span><span class="s2">!= </span><span class="s6">0 </span><span class="s0">else </span><span class="s6">0</span>

                <span class="s1">result </span><span class="s2">= {</span>
                    <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ITUG'</span><span class="s2">,</span>
                    <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                    <span class="s4">'t_statistic'</span><span class="s2">: </span><span class="s1">t_stat</span><span class="s2">,</span>
                    <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">p_val</span><span class="s2">,</span>
                    <span class="s4">'mean_difference'</span><span class="s2">: </span><span class="s1">mean_diff</span><span class="s2">,</span>
                    <span class="s4">'effect_size_d'</span><span class="s2">: </span><span class="s1">cohen_d</span><span class="s2">,</span>
                    <span class="s4">'significant'</span><span class="s2">: </span><span class="s1">p_val </span><span class="s2">&lt; </span><span class="s6">0.05</span>
                <span class="s2">}</span>
                <span class="s1">t_test_results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">result</span><span class="s2">)</span>

                <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;</span><span class="s0">\n</span><span class="s4">Paired t-test for ITUG </span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">:&quot;</span><span class="s2">)</span>
                <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;t = </span><span class="s0">{</span><span class="s1">t_stat</span><span class="s0">:</span><span class="s4">.4f</span><span class="s0">}</span><span class="s4">, p = </span><span class="s0">{</span><span class="s1">p_val</span><span class="s0">:</span><span class="s4">.4f</span><span class="s0">}</span><span class="s4">, Cohen's d = </span><span class="s0">{</span><span class="s1">cohen_d</span><span class="s0">:</span><span class="s4">.4f</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
                <span class="s0">if </span><span class="s1">p_val </span><span class="s2">&lt; </span><span class="s6">0.05</span><span class="s2">:</span>
                    <span class="s1">print</span><span class="s2">(</span>
                        <span class="s4">f&quot;Significant change detected: </span><span class="s0">{</span><span class="s4">'increase' </span><span class="s0">if </span><span class="s1">mean_diff </span><span class="s2">&gt; </span><span class="s6">0 </span><span class="s0">else </span><span class="s4">'decrease'</span><span class="s0">} </span><span class="s4">after cognitive dissonance&quot;</span><span class="s2">)</span>
            <span class="s0">except </span><span class="s1">Exception </span><span class="s0">as </span><span class="s1">e</span><span class="s2">:</span>
                <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Error in t-test for ITUG </span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">: </span><span class="s0">{</span><span class="s1">e</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

        <span class="s3"># T-tests for ISWAY parameters</span>
        <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">isway_params</span><span class="s2">:</span>
            <span class="s0">try</span><span class="s2">:</span>
                <span class="s3"># Perform paired t-test</span>
                <span class="s1">t_stat</span><span class="s2">, </span><span class="s1">p_val </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">ttest_rel</span><span class="s2">(</span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'pre_isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">], </span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'post_isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">])</span>

                <span class="s3"># Calculate Cohen's d effect size</span>
                <span class="s1">mean_diff </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">mean</span><span class="s2">(</span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'post_isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">] - </span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'pre_isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">])</span>
                <span class="s1">std_diff </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">std</span><span class="s2">(</span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'post_isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">] - </span><span class="s1">df</span><span class="s2">[</span><span class="s4">f'pre_isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">], </span><span class="s1">ddof</span><span class="s2">=</span><span class="s6">1</span><span class="s2">)</span>
                <span class="s1">cohen_d </span><span class="s2">= </span><span class="s1">mean_diff </span><span class="s2">/ </span><span class="s1">std_diff </span><span class="s0">if </span><span class="s1">std_diff </span><span class="s2">!= </span><span class="s6">0 </span><span class="s0">else </span><span class="s6">0</span>

                <span class="s1">result </span><span class="s2">= {</span>
                    <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ISWAY'</span><span class="s2">,</span>
                    <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                    <span class="s4">'t_statistic'</span><span class="s2">: </span><span class="s1">t_stat</span><span class="s2">,</span>
                    <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">p_val</span><span class="s2">,</span>
                    <span class="s4">'mean_difference'</span><span class="s2">: </span><span class="s1">mean_diff</span><span class="s2">,</span>
                    <span class="s4">'effect_size_d'</span><span class="s2">: </span><span class="s1">cohen_d</span><span class="s2">,</span>
                    <span class="s4">'significant'</span><span class="s2">: </span><span class="s1">p_val </span><span class="s2">&lt; </span><span class="s6">0.05</span>
                <span class="s2">}</span>
                <span class="s1">t_test_results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">result</span><span class="s2">)</span>

                <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;</span><span class="s0">\n</span><span class="s4">Paired t-test for ISWAY </span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">:&quot;</span><span class="s2">)</span>
                <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;t = </span><span class="s0">{</span><span class="s1">t_stat</span><span class="s0">:</span><span class="s4">.4f</span><span class="s0">}</span><span class="s4">, p = </span><span class="s0">{</span><span class="s1">p_val</span><span class="s0">:</span><span class="s4">.4f</span><span class="s0">}</span><span class="s4">, Cohen's d = </span><span class="s0">{</span><span class="s1">cohen_d</span><span class="s0">:</span><span class="s4">.4f</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
                <span class="s0">if </span><span class="s1">p_val </span><span class="s2">&lt; </span><span class="s6">0.05</span><span class="s2">:</span>
                    <span class="s1">print</span><span class="s2">(</span>
                        <span class="s4">f&quot;Significant change detected: </span><span class="s0">{</span><span class="s4">'increase' </span><span class="s0">if </span><span class="s1">mean_diff </span><span class="s2">&gt; </span><span class="s6">0 </span><span class="s0">else </span><span class="s4">'decrease'</span><span class="s0">} </span><span class="s4">after cognitive dissonance&quot;</span><span class="s2">)</span>
            <span class="s0">except </span><span class="s1">Exception </span><span class="s0">as </span><span class="s1">e</span><span class="s2">:</span>
                <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Error in t-test for ISWAY </span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">: </span><span class="s0">{</span><span class="s1">e</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

        <span class="s3"># Convert to DataFrame</span>
        <span class="s1">t_test_results_df </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">t_test_results</span><span class="s2">)</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">Paired T-test Results Summary:&quot;</span><span class="s2">)</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s1">t_test_results_df</span><span class="s2">)</span>

        <span class="s0">return </span><span class="s1">t_test_results_df</span>

    <span class="s3"># Function for change score analysis</span>
    <span class="s0">def </span><span class="s1">change_score_analysis</span><span class="s2">(</span><span class="s1">balance_changes</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot; 
        Analyze correlations between cognitive dissonance measures and balance changes 
        &quot;&quot;&quot;</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">=== CHANGE SCORE ANALYSIS ===</span><span class="s0">\n</span><span class="s4">&quot;</span><span class="s2">)</span>

        <span class="s3"># Define cognitive dissonance measures</span>
        <span class="s1">cd_measures </span><span class="s2">= [</span><span class="s4">'average_rating_change'</span><span class="s2">, </span><span class="s4">'average_rejected_rating_difference'</span><span class="s2">]</span>

        <span class="s3"># Define balance change parameters</span>
        <span class="s1">balance_params </span><span class="s2">= [</span><span class="s1">col </span><span class="s0">for </span><span class="s1">col </span><span class="s0">in </span><span class="s1">balance_changes</span><span class="s2">.</span><span class="s1">columns </span><span class="s0">if </span><span class="s4">'_change' </span><span class="s0">in </span><span class="s1">col</span><span class="s2">]</span>

        <span class="s1">change_corr_results </span><span class="s2">= []</span>

        <span class="s3"># Analyze correlations between cognitive dissonance and balance changes</span>
        <span class="s0">for </span><span class="s1">cd_measure </span><span class="s0">in </span><span class="s1">cd_measures</span><span class="s2">:</span>
            <span class="s0">for </span><span class="s1">balance_param </span><span class="s0">in </span><span class="s1">balance_params</span><span class="s2">:</span>
                <span class="s3"># Skip if the parameter is a cognitive dissonance measure</span>
                <span class="s0">if </span><span class="s1">balance_param </span><span class="s0">in </span><span class="s1">cd_measures</span><span class="s2">:</span>
                    <span class="s0">continue</span>

                <span class="s0">try</span><span class="s2">:</span>
                    <span class="s3"># Calculate correlation</span>
                    <span class="s1">corr</span><span class="s2">, </span><span class="s1">p_val </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">pearsonr</span><span class="s2">(</span><span class="s1">balance_changes</span><span class="s2">[</span><span class="s1">cd_measure</span><span class="s2">], </span><span class="s1">balance_changes</span><span class="s2">[</span><span class="s1">balance_param</span><span class="s2">])</span>

                    <span class="s1">result </span><span class="s2">= {</span>
                        <span class="s4">'cognitive_dissonance_measure'</span><span class="s2">: </span><span class="s1">cd_measure</span><span class="s2">,</span>
                        <span class="s4">'balance_parameter'</span><span class="s2">: </span><span class="s1">balance_param</span><span class="s2">,</span>
                        <span class="s4">'correlation'</span><span class="s2">: </span><span class="s1">corr</span><span class="s2">,</span>
                        <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">p_val</span><span class="s2">,</span>
                        <span class="s4">'significant'</span><span class="s2">: </span><span class="s1">p_val </span><span class="s2">&lt; </span><span class="s6">0.05</span>
                    <span class="s2">}</span>
                    <span class="s1">change_corr_results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">result</span><span class="s2">)</span>
                <span class="s0">except </span><span class="s1">Exception </span><span class="s0">as </span><span class="s1">e</span><span class="s2">:</span>
                    <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Error calculating correlation between </span><span class="s0">{</span><span class="s1">cd_measure</span><span class="s0">} </span><span class="s4">and </span><span class="s0">{</span><span class="s1">balance_param</span><span class="s0">}</span><span class="s4">: </span><span class="s0">{</span><span class="s1">e</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

        <span class="s3"># Convert to DataFrame</span>
        <span class="s1">change_corr_df </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">change_corr_results</span><span class="s2">)</span>

        <span class="s3"># Sort by significance and correlation strength</span>
        <span class="s1">change_corr_df </span><span class="s2">= </span><span class="s1">change_corr_df</span><span class="s2">.</span><span class="s1">sort_values</span><span class="s2">(</span><span class="s1">by</span><span class="s2">=[</span><span class="s4">'significant'</span><span class="s2">, </span><span class="s4">'correlation'</span><span class="s2">], </span><span class="s1">ascending</span><span class="s2">=[</span><span class="s0">False</span><span class="s2">, </span><span class="s0">False</span><span class="s2">])</span>

        <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">Correlations between cognitive dissonance and balance changes:&quot;</span><span class="s2">)</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s1">change_corr_df</span><span class="s2">)</span>

        <span class="s3"># Create visualizations for significant correlations</span>
        <span class="s1">significant_corrs </span><span class="s2">= </span><span class="s1">change_corr_df</span><span class="s2">[</span><span class="s1">change_corr_df</span><span class="s2">[</span><span class="s4">'significant'</span><span class="s2">]]</span>

        <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">significant_corrs</span><span class="s2">) &gt; </span><span class="s6">0</span><span class="s2">:</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">Generating scatter plots for significant correlations...&quot;</span><span class="s2">)</span>

            <span class="s3"># Create directory for visualizations if it doesn't exist</span>
            <span class="s1">os</span><span class="s2">.</span><span class="s1">makedirs</span><span class="s2">(</span><span class="s4">&quot;analysis_results&quot;</span><span class="s2">, </span><span class="s1">exist_ok</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

            <span class="s0">for </span><span class="s1">_</span><span class="s2">, </span><span class="s1">row </span><span class="s0">in </span><span class="s1">significant_corrs</span><span class="s2">.</span><span class="s1">iterrows</span><span class="s2">():</span>
                <span class="s0">try</span><span class="s2">:</span>
                    <span class="s1">cd_measure </span><span class="s2">= </span><span class="s1">row</span><span class="s2">[</span><span class="s4">'cognitive_dissonance_measure'</span><span class="s2">]</span>
                    <span class="s1">balance_param </span><span class="s2">= </span><span class="s1">row</span><span class="s2">[</span><span class="s4">'balance_parameter'</span><span class="s2">]</span>
                    <span class="s1">corr </span><span class="s2">= </span><span class="s1">row</span><span class="s2">[</span><span class="s4">'correlation'</span><span class="s2">]</span>
                    <span class="s1">p_val </span><span class="s2">= </span><span class="s1">row</span><span class="s2">[</span><span class="s4">'p_value'</span><span class="s2">]</span>

                    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">8</span><span class="s2">, </span><span class="s6">6</span><span class="s2">))</span>
                    <span class="s1">sns</span><span class="s2">.</span><span class="s1">scatterplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=</span><span class="s1">balance_changes</span><span class="s2">[</span><span class="s1">cd_measure</span><span class="s2">], </span><span class="s1">y</span><span class="s2">=</span><span class="s1">balance_changes</span><span class="s2">[</span><span class="s1">balance_param</span><span class="s2">])</span>
                    <span class="s1">sns</span><span class="s2">.</span><span class="s1">regplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=</span><span class="s1">balance_changes</span><span class="s2">[</span><span class="s1">cd_measure</span><span class="s2">], </span><span class="s1">y</span><span class="s2">=</span><span class="s1">balance_changes</span><span class="s2">[</span><span class="s1">balance_param</span><span class="s2">], </span><span class="s1">scatter</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

                    <span class="s1">plt</span><span class="s2">.</span><span class="s1">title</span><span class="s2">(</span><span class="s4">f&quot;Correlation between </span><span class="s0">{</span><span class="s1">cd_measure</span><span class="s0">} </span><span class="s4">and </span><span class="s0">{</span><span class="s1">balance_param</span><span class="s0">}\n</span><span class="s4">r = </span><span class="s0">{</span><span class="s1">corr</span><span class="s0">:</span><span class="s4">.3f</span><span class="s0">}</span><span class="s4">, p = </span><span class="s0">{</span><span class="s1">p_val</span><span class="s0">:</span><span class="s4">.3f</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
                    <span class="s1">plt</span><span class="s2">.</span><span class="s1">xlabel</span><span class="s2">(</span><span class="s1">cd_measure</span><span class="s2">)</span>
                    <span class="s1">plt</span><span class="s2">.</span><span class="s1">ylabel</span><span class="s2">(</span><span class="s1">balance_param</span><span class="s2">)</span>

                    <span class="s3"># Save the plot</span>
                    <span class="s1">plt</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s4">f&quot;analysis_results/correlation_</span><span class="s0">{</span><span class="s1">cd_measure</span><span class="s0">}</span><span class="s4">_</span><span class="s0">{</span><span class="s1">balance_param</span><span class="s0">}</span><span class="s4">.png&quot;</span><span class="s2">)</span>
                    <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>
                <span class="s0">except </span><span class="s1">Exception </span><span class="s0">as </span><span class="s1">e</span><span class="s2">:</span>
                    <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Error creating scatter plot for </span><span class="s0">{</span><span class="s1">cd_measure</span><span class="s0">} </span><span class="s4">and </span><span class="s0">{</span><span class="s1">balance_param</span><span class="s0">}</span><span class="s4">: </span><span class="s0">{</span><span class="s1">e</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

        <span class="s0">return </span><span class="s1">change_corr_df</span>

    <span class="s3"># Function for mixed effects model</span>
    <span class="s0">def </span><span class="s1">mixed_effects_model</span><span class="s2">(</span><span class="s1">df</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot; 
        Run mixed effects models to analyze both the impact of initial balance on cognitive dissonance 
        and the effect of cognitive dissonance on subsequent balance 
        &quot;&quot;&quot;</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">=== MIXED EFFECTS MODEL ANALYSIS ===</span><span class="s0">\n</span><span class="s4">&quot;</span><span class="s2">)</span>

        <span class="s3"># Prepare data for mixed effects model</span>
        <span class="s3"># We need to restructure the data to have both pre and post measurements in a single dataframe</span>

        <span class="s3"># First, create a dataframe for ITUG measurements</span>
        <span class="s1">itug_params </span><span class="s2">= [</span><span class="s4">'PC1_std'</span><span class="s2">, </span><span class="s4">'PC1_range'</span><span class="s2">, </span><span class="s4">'PC1_spectral_entropy'</span><span class="s2">, </span><span class="s4">'stride_frequency'</span><span class="s2">]</span>
        <span class="s1">itug_data </span><span class="s2">= []</span>

        <span class="s0">for </span><span class="s1">_</span><span class="s2">, </span><span class="s1">row </span><span class="s0">in </span><span class="s1">df</span><span class="s2">.</span><span class="s1">iterrows</span><span class="s2">():</span>
            <span class="s1">subject </span><span class="s2">= </span><span class="s1">row</span><span class="s2">[</span><span class="s4">'name'</span><span class="s2">]</span>

            <span class="s3"># Pre-test data</span>
            <span class="s1">pre_data </span><span class="s2">= {</span>
                <span class="s4">'subject'</span><span class="s2">: </span><span class="s1">subject</span><span class="s2">,</span>
                <span class="s4">'time'</span><span class="s2">: </span><span class="s4">'pre'</span><span class="s2">,</span>
                <span class="s4">'cognitive_dissonance'</span><span class="s2">: </span><span class="s0">None  </span><span class="s3"># Not experienced yet</span>
            <span class="s2">}</span>

            <span class="s3"># Add all ITUG parameters</span>
            <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">itug_params</span><span class="s2">:</span>
                <span class="s1">pre_data</span><span class="s2">[</span><span class="s1">param</span><span class="s2">] = </span><span class="s1">row</span><span class="s2">[</span><span class="s4">f'pre_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">]</span>

            <span class="s1">itug_data</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">pre_data</span><span class="s2">)</span>

            <span class="s3"># Post-test data</span>
            <span class="s1">post_data </span><span class="s2">= {</span>
                <span class="s4">'subject'</span><span class="s2">: </span><span class="s1">subject</span><span class="s2">,</span>
                <span class="s4">'time'</span><span class="s2">: </span><span class="s4">'post'</span><span class="s2">,</span>
                <span class="s4">'cognitive_dissonance'</span><span class="s2">: </span><span class="s1">row</span><span class="s2">[</span><span class="s4">'average_rating_change'</span><span class="s2">],</span>
                <span class="s4">'rejected_rating_diff'</span><span class="s2">: </span><span class="s1">row</span><span class="s2">[</span><span class="s4">'average_rejected_rating_difference'</span><span class="s2">]</span>
            <span class="s2">}</span>

            <span class="s3"># Add all ITUG parameters</span>
            <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">itug_params</span><span class="s2">:</span>
                <span class="s1">post_data</span><span class="s2">[</span><span class="s1">param</span><span class="s2">] = </span><span class="s1">row</span><span class="s2">[</span><span class="s4">f'post_itug_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">]</span>

            <span class="s1">itug_data</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">post_data</span><span class="s2">)</span>

        <span class="s3"># Convert to DataFrame</span>
        <span class="s1">itug_long </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">itug_data</span><span class="s2">)</span>

        <span class="s3"># Same for ISWAY</span>
        <span class="s1">isway_params </span><span class="s2">= [</span><span class="s4">'PC1_std'</span><span class="s2">, </span><span class="s4">'PC1_range'</span><span class="s2">, </span><span class="s4">'PC1_spectral_entropy'</span><span class="s2">, </span><span class="s4">'sway_area'</span><span class="s2">, </span><span class="s4">'mean_distance'</span><span class="s2">, </span><span class="s4">'path_length'</span><span class="s2">]</span>
        <span class="s1">isway_data </span><span class="s2">= []</span>

        <span class="s0">for </span><span class="s1">_</span><span class="s2">, </span><span class="s1">row </span><span class="s0">in </span><span class="s1">df</span><span class="s2">.</span><span class="s1">iterrows</span><span class="s2">():</span>
            <span class="s1">subject </span><span class="s2">= </span><span class="s1">row</span><span class="s2">[</span><span class="s4">'name'</span><span class="s2">]</span>

            <span class="s3"># Pre-test data</span>
            <span class="s1">pre_data </span><span class="s2">= {</span>
                <span class="s4">'subject'</span><span class="s2">: </span><span class="s1">subject</span><span class="s2">,</span>
                <span class="s4">'time'</span><span class="s2">: </span><span class="s4">'pre'</span><span class="s2">,</span>
                <span class="s4">'cognitive_dissonance'</span><span class="s2">: </span><span class="s0">None  </span><span class="s3"># Not experienced yet</span>
            <span class="s2">}</span>

            <span class="s3"># Add all ISWAY parameters</span>
            <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">isway_params</span><span class="s2">:</span>
                <span class="s1">pre_data</span><span class="s2">[</span><span class="s1">param</span><span class="s2">] = </span><span class="s1">row</span><span class="s2">[</span><span class="s4">f'pre_isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">]</span>

            <span class="s1">isway_data</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">pre_data</span><span class="s2">)</span>

            <span class="s3"># Post-test data</span>
            <span class="s1">post_data </span><span class="s2">= {</span>
                <span class="s4">'subject'</span><span class="s2">: </span><span class="s1">subject</span><span class="s2">,</span>
                <span class="s4">'time'</span><span class="s2">: </span><span class="s4">'post'</span><span class="s2">,</span>
                <span class="s4">'cognitive_dissonance'</span><span class="s2">: </span><span class="s1">row</span><span class="s2">[</span><span class="s4">'average_rating_change'</span><span class="s2">],</span>
                <span class="s4">'rejected_rating_diff'</span><span class="s2">: </span><span class="s1">row</span><span class="s2">[</span><span class="s4">'average_rejected_rating_difference'</span><span class="s2">]</span>
            <span class="s2">}</span>

            <span class="s3"># Add all ISWAY parameters</span>
            <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">isway_params</span><span class="s2">:</span>
                <span class="s1">post_data</span><span class="s2">[</span><span class="s1">param</span><span class="s2">] = </span><span class="s1">row</span><span class="s2">[</span><span class="s4">f'post_isway_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">]</span>

            <span class="s1">isway_data</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">post_data</span><span class="s2">)</span>

        <span class="s3"># Convert to DataFrame</span>
        <span class="s1">isway_long </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">isway_data</span><span class="s2">)</span>

        <span class="s1">mixed_model_results </span><span class="s2">= []</span>

        <span class="s3"># Run mixed effects models for ITUG parameters</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">Mixed Effects Models for ITUG parameters:&quot;</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">itug_params</span><span class="s2">:</span>
            <span class="s0">try</span><span class="s2">:</span>
                <span class="s3"># Filter only post data to analyze effect of pre-values on cognitive dissonance</span>
                <span class="s1">post_data </span><span class="s2">= </span><span class="s1">itug_long</span><span class="s2">[</span><span class="s1">itug_long</span><span class="s2">[</span><span class="s4">'time'</span><span class="s2">] == </span><span class="s4">'post'</span><span class="s2">].</span><span class="s1">copy</span><span class="s2">()</span>

                <span class="s3"># Add pre-values to the post data</span>
                <span class="s0">for </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">subj </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">post_data</span><span class="s2">[</span><span class="s4">'subject'</span><span class="s2">]):</span>
                    <span class="s1">pre_row </span><span class="s2">= </span><span class="s1">itug_long</span><span class="s2">[(</span><span class="s1">itug_long</span><span class="s2">[</span><span class="s4">'subject'</span><span class="s2">] == </span><span class="s1">subj</span><span class="s2">) &amp; (</span><span class="s1">itug_long</span><span class="s2">[</span><span class="s4">'time'</span><span class="s2">] == </span><span class="s4">'pre'</span><span class="s2">)]</span>
                    <span class="s0">if not </span><span class="s1">pre_row</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">:</span>
                        <span class="s1">post_data</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">post_data</span><span class="s2">.</span><span class="s1">index</span><span class="s2">[</span><span class="s1">idx</span><span class="s2">], </span><span class="s4">f'pre_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">] = </span><span class="s1">pre_row</span><span class="s2">[</span><span class="s1">param</span><span class="s2">].</span><span class="s1">values</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]</span>

                <span class="s3"># Model 1: Effect of pre-balance on cognitive dissonance</span>
                <span class="s1">formula1 </span><span class="s2">= </span><span class="s4">f&quot;cognitive_dissonance ~ pre_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">&quot;</span>
                <span class="s1">model1 </span><span class="s2">= </span><span class="s1">smf</span><span class="s2">.</span><span class="s1">ols</span><span class="s2">(</span><span class="s1">formula1</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">post_data</span><span class="s2">).</span><span class="s1">fit</span><span class="s2">()</span>

                <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;</span><span class="s0">\n</span><span class="s4">Effect of pre-</span><span class="s0">{</span><span class="s1">param</span><span class="s0">} </span><span class="s4">on cognitive dissonance:&quot;</span><span class="s2">)</span>
                <span class="s1">print</span><span class="s2">(</span><span class="s1">model1</span><span class="s2">.</span><span class="s1">summary</span><span class="s2">())</span>

                <span class="s1">result1 </span><span class="s2">= {</span>
                    <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ITUG'</span><span class="s2">,</span>
                    <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                    <span class="s4">'model_type'</span><span class="s2">: </span><span class="s4">'pre_balance_on_cd'</span><span class="s2">,</span>
                    <span class="s4">'coefficient'</span><span class="s2">: </span><span class="s1">model1</span><span class="s2">.</span><span class="s1">params</span><span class="s2">[</span><span class="s4">f'pre_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">],</span>
                    <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">model1</span><span class="s2">.</span><span class="s1">pvalues</span><span class="s2">[</span><span class="s4">f'pre_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">],</span>
                    <span class="s4">'r_squared'</span><span class="s2">: </span><span class="s1">model1</span><span class="s2">.</span><span class="s1">rsquared</span><span class="s2">,</span>
                    <span class="s4">'significant'</span><span class="s2">: </span><span class="s1">model1</span><span class="s2">.</span><span class="s1">pvalues</span><span class="s2">[</span><span class="s4">f'pre_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">] &lt; </span><span class="s6">0.05</span>
                <span class="s2">}</span>
                <span class="s1">mixed_model_results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">result1</span><span class="s2">)</span>

                <span class="s3"># Model 2: Effect of cognitive dissonance on post-balance, controlling for pre-balance</span>
                <span class="s1">formula2 </span><span class="s2">= </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">param</span><span class="s0">} </span><span class="s4">~ cognitive_dissonance + pre_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">&quot;</span>
                <span class="s1">model2 </span><span class="s2">= </span><span class="s1">smf</span><span class="s2">.</span><span class="s1">ols</span><span class="s2">(</span><span class="s1">formula2</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">post_data</span><span class="s2">).</span><span class="s1">fit</span><span class="s2">()</span>

                <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;</span><span class="s0">\n</span><span class="s4">Effect of cognitive dissonance on post-</span><span class="s0">{</span><span class="s1">param</span><span class="s0">} </span><span class="s4">(controlling for pre-</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">):&quot;</span><span class="s2">)</span>
                <span class="s1">print</span><span class="s2">(</span><span class="s1">model2</span><span class="s2">.</span><span class="s1">summary</span><span class="s2">())</span>

                <span class="s1">result2 </span><span class="s2">= {</span>
                    <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ITUG'</span><span class="s2">,</span>
                    <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                    <span class="s4">'model_type'</span><span class="s2">: </span><span class="s4">'cd_on_post_balance'</span><span class="s2">,</span>
                    <span class="s4">'coefficient'</span><span class="s2">: </span><span class="s1">model2</span><span class="s2">.</span><span class="s1">params</span><span class="s2">[</span><span class="s4">'cognitive_dissonance'</span><span class="s2">],</span>
                    <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">model2</span><span class="s2">.</span><span class="s1">pvalues</span><span class="s2">[</span><span class="s4">'cognitive_dissonance'</span><span class="s2">],</span>
                    <span class="s4">'r_squared'</span><span class="s2">: </span><span class="s1">model2</span><span class="s2">.</span><span class="s1">rsquared</span><span class="s2">,</span>
                    <span class="s4">'significant'</span><span class="s2">: </span><span class="s1">model2</span><span class="s2">.</span><span class="s1">pvalues</span><span class="s2">[</span><span class="s4">'cognitive_dissonance'</span><span class="s2">] &lt; </span><span class="s6">0.05</span>
                <span class="s2">}</span>
                <span class="s1">mixed_model_results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">result2</span><span class="s2">)</span>

            <span class="s0">except </span><span class="s1">Exception </span><span class="s0">as </span><span class="s1">e</span><span class="s2">:</span>
                <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Error in mixed effects model for ITUG </span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">: </span><span class="s0">{</span><span class="s1">e</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

        <span class="s3"># Run mixed effects models for ISWAY parameters</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">Mixed Effects Models for ISWAY parameters:&quot;</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">param </span><span class="s0">in </span><span class="s1">isway_params</span><span class="s2">:</span>
            <span class="s0">try</span><span class="s2">:</span>
                <span class="s3"># Filter only post data to analyze effect of pre-values on cognitive dissonance</span>
                <span class="s1">post_data </span><span class="s2">= </span><span class="s1">isway_long</span><span class="s2">[</span><span class="s1">isway_long</span><span class="s2">[</span><span class="s4">'time'</span><span class="s2">] == </span><span class="s4">'post'</span><span class="s2">].</span><span class="s1">copy</span><span class="s2">()</span>

                <span class="s3"># Add pre-values to the post data</span>
                <span class="s0">for </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">subj </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">post_data</span><span class="s2">[</span><span class="s4">'subject'</span><span class="s2">]):</span>
                    <span class="s1">pre_row </span><span class="s2">= </span><span class="s1">isway_long</span><span class="s2">[(</span><span class="s1">isway_long</span><span class="s2">[</span><span class="s4">'subject'</span><span class="s2">] == </span><span class="s1">subj</span><span class="s2">) &amp; (</span><span class="s1">isway_long</span><span class="s2">[</span><span class="s4">'time'</span><span class="s2">] == </span><span class="s4">'pre'</span><span class="s2">)]</span>
                    <span class="s0">if not </span><span class="s1">pre_row</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">:</span>
                        <span class="s1">post_data</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">post_data</span><span class="s2">.</span><span class="s1">index</span><span class="s2">[</span><span class="s1">idx</span><span class="s2">], </span><span class="s4">f'pre_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">] = </span><span class="s1">pre_row</span><span class="s2">[</span><span class="s1">param</span><span class="s2">].</span><span class="s1">values</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]</span>
                        <span class="s1">post_data</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">post_data</span><span class="s2">.</span><span class="s1">index</span><span class="s2">[</span><span class="s1">idx</span><span class="s2">], </span><span class="s4">f'pre_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">] = </span><span class="s1">pre_row</span><span class="s2">[</span><span class="s1">param</span><span class="s2">].</span><span class="s1">values</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]</span>

                    <span class="s3"># Model 1: Effect of pre-balance on cognitive dissonance</span>
                    <span class="s1">formula1 </span><span class="s2">= </span><span class="s4">f&quot;cognitive_dissonance ~ pre_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">&quot;</span>
                    <span class="s1">model1 </span><span class="s2">= </span><span class="s1">smf</span><span class="s2">.</span><span class="s1">ols</span><span class="s2">(</span><span class="s1">formula1</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">post_data</span><span class="s2">).</span><span class="s1">fit</span><span class="s2">()</span>

                    <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;</span><span class="s0">\n</span><span class="s4">Effect of pre-</span><span class="s0">{</span><span class="s1">param</span><span class="s0">} </span><span class="s4">on cognitive dissonance:&quot;</span><span class="s2">)</span>
                    <span class="s1">print</span><span class="s2">(</span><span class="s1">model1</span><span class="s2">.</span><span class="s1">summary</span><span class="s2">())</span>

                    <span class="s1">result1 </span><span class="s2">= {</span>
                        <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ISWAY'</span><span class="s2">,</span>
                        <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                        <span class="s4">'model_type'</span><span class="s2">: </span><span class="s4">'pre_balance_on_cd'</span><span class="s2">,</span>
                        <span class="s4">'coefficient'</span><span class="s2">: </span><span class="s1">model1</span><span class="s2">.</span><span class="s1">params</span><span class="s2">[</span><span class="s4">f'pre_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">],</span>
                        <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">model1</span><span class="s2">.</span><span class="s1">pvalues</span><span class="s2">[</span><span class="s4">f'pre_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">],</span>
                        <span class="s4">'r_squared'</span><span class="s2">: </span><span class="s1">model1</span><span class="s2">.</span><span class="s1">rsquared</span><span class="s2">,</span>
                        <span class="s4">'significant'</span><span class="s2">: </span><span class="s1">model1</span><span class="s2">.</span><span class="s1">pvalues</span><span class="s2">[</span><span class="s4">f'pre_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">'</span><span class="s2">] &lt; </span><span class="s6">0.05</span>
                    <span class="s2">}</span>
                    <span class="s1">mixed_model_results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">result1</span><span class="s2">)</span>

                    <span class="s3"># Model 2: Effect of cognitive dissonance on post-balance, controlling for pre-balance</span>
                    <span class="s1">formula2 </span><span class="s2">= </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">param</span><span class="s0">} </span><span class="s4">~ cognitive_dissonance + pre_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">&quot;</span>
                    <span class="s1">model2 </span><span class="s2">= </span><span class="s1">smf</span><span class="s2">.</span><span class="s1">ols</span><span class="s2">(</span><span class="s1">formula2</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">post_data</span><span class="s2">).</span><span class="s1">fit</span><span class="s2">()</span>

                    <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;</span><span class="s0">\n</span><span class="s4">Effect of cognitive dissonance on post-</span><span class="s0">{</span><span class="s1">param</span><span class="s0">} </span><span class="s4">(controlling for pre-</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">):&quot;</span><span class="s2">)</span>
                    <span class="s1">print</span><span class="s2">(</span><span class="s1">model2</span><span class="s2">.</span><span class="s1">summary</span><span class="s2">())</span>

                    <span class="s1">result2 </span><span class="s2">= {</span>
                        <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ISWAY'</span><span class="s2">,</span>
                        <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                        <span class="s4">'model_type'</span><span class="s2">: </span><span class="s4">'cd_on_post_balance'</span><span class="s2">,</span>
                        <span class="s4">'coefficient'</span><span class="s2">: </span><span class="s1">model2</span><span class="s2">.</span><span class="s1">params</span><span class="s2">[</span><span class="s4">'cognitive_dissonance'</span><span class="s2">],</span>
                        <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">model2</span><span class="s2">.</span><span class="s1">pvalues</span><span class="s2">[</span><span class="s4">'cognitive_dissonance'</span><span class="s2">],</span>
                        <span class="s4">'r_squared'</span><span class="s2">: </span><span class="s1">model2</span><span class="s2">.</span><span class="s1">rsquared</span><span class="s2">,</span>
                        <span class="s4">'significant'</span><span class="s2">: </span><span class="s1">model2</span><span class="s2">.</span><span class="s1">pvalues</span><span class="s2">[</span><span class="s4">'cognitive_dissonance'</span><span class="s2">] &lt; </span><span class="s6">0.05</span>
                    <span class="s2">}</span>
                    <span class="s1">mixed_model_results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">result2</span><span class="s2">)</span>

                    <span class="s3"># Additional model for rejected rating difference</span>
                    <span class="s1">formula3 </span><span class="s2">= </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">param</span><span class="s0">} </span><span class="s4">~ rejected_rating_diff + pre_</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">&quot;</span>
                    <span class="s1">model3 </span><span class="s2">= </span><span class="s1">smf</span><span class="s2">.</span><span class="s1">ols</span><span class="s2">(</span><span class="s1">formula3</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">post_data</span><span class="s2">).</span><span class="s1">fit</span><span class="s2">()</span>

                    <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;</span><span class="s0">\n</span><span class="s4">Effect of rejected rating difference on post-</span><span class="s0">{</span><span class="s1">param</span><span class="s0">} </span><span class="s4">(controlling for pre-</span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">):&quot;</span><span class="s2">)</span>
                    <span class="s1">print</span><span class="s2">(</span><span class="s1">model3</span><span class="s2">.</span><span class="s1">summary</span><span class="s2">())</span>

                    <span class="s1">result3 </span><span class="s2">= {</span>
                        <span class="s4">'test_type'</span><span class="s2">: </span><span class="s4">'ISWAY'</span><span class="s2">,</span>
                        <span class="s4">'parameter'</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                        <span class="s4">'model_type'</span><span class="s2">: </span><span class="s4">'rejected_diff_on_post_balance'</span><span class="s2">,</span>
                        <span class="s4">'coefficient'</span><span class="s2">: </span><span class="s1">model3</span><span class="s2">.</span><span class="s1">params</span><span class="s2">[</span><span class="s4">'rejected_rating_diff'</span><span class="s2">],</span>
                        <span class="s4">'p_value'</span><span class="s2">: </span><span class="s1">model3</span><span class="s2">.</span><span class="s1">pvalues</span><span class="s2">[</span><span class="s4">'rejected_rating_diff'</span><span class="s2">],</span>
                        <span class="s4">'r_squared'</span><span class="s2">: </span><span class="s1">model3</span><span class="s2">.</span><span class="s1">rsquared</span><span class="s2">,</span>
                        <span class="s4">'significant'</span><span class="s2">: </span><span class="s1">model3</span><span class="s2">.</span><span class="s1">pvalues</span><span class="s2">[</span><span class="s4">'rejected_rating_diff'</span><span class="s2">] &lt; </span><span class="s6">0.05</span>
                    <span class="s2">}</span>
                    <span class="s1">mixed_model_results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">result3</span><span class="s2">)</span>

                    <span class="s0">except </span><span class="s1">Exception </span><span class="s0">as </span><span class="s1">e</span><span class="s2">:</span>
                    <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Error in mixed effects model for ISWAY </span><span class="s0">{</span><span class="s1">param</span><span class="s0">}</span><span class="s4">: </span><span class="s0">{</span><span class="s1">e</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

                <span class="s0">return </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">mixed_model_results</span><span class="s2">)</span>

                <span class="s0">def </span><span class="s1">create_visualizations</span><span class="s2">(</span><span class="s1">results</span><span class="s2">, </span><span class="s1">output_dir</span><span class="s2">):</span>
                    <span class="s5">&quot;&quot;&quot; 
                    Create and save visualizations based on analysis results 
                    &quot;&quot;&quot;</span>
                    <span class="s1">os</span><span class="s2">.</span><span class="s1">makedirs</span><span class="s2">(</span><span class="s1">output_dir</span><span class="s2">, </span><span class="s1">exist_ok</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

                    <span class="s3"># 1. Correlation Heatmap</span>
                    <span class="s0">try</span><span class="s2">:</span>
                        <span class="s1">corr_df </span><span class="s2">= </span><span class="s1">results</span><span class="s2">[</span><span class="s4">'correlations'</span><span class="s2">]</span>
                        <span class="s0">if not </span><span class="s1">corr_df</span><span class="s2">.</span><span class="s1">empty </span><span class="s0">and not </span><span class="s1">corr_df</span><span class="s2">[</span><span class="s4">'correlation'</span><span class="s2">].</span><span class="s1">isna</span><span class="s2">().</span><span class="s1">all</span><span class="s2">():</span>
                            <span class="s1">pivot_data </span><span class="s2">= </span><span class="s1">corr_df</span><span class="s2">.</span><span class="s1">pivot_table</span><span class="s2">(</span>
                                <span class="s1">index</span><span class="s2">=[</span><span class="s4">'test_type'</span><span class="s2">, </span><span class="s4">'parameter'</span><span class="s2">],</span>
                                <span class="s1">columns</span><span class="s2">=</span><span class="s4">'cd_measure'</span><span class="s2">,</span>
                                <span class="s1">values</span><span class="s2">=</span><span class="s4">'correlation'</span>
                            <span class="s2">)</span>
                            <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">12</span><span class="s2">, </span><span class="s6">10</span><span class="s2">))</span>
                            <span class="s1">sns</span><span class="s2">.</span><span class="s1">heatmap</span><span class="s2">(</span><span class="s1">pivot_data</span><span class="s2">, </span><span class="s1">annot</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s4">'coolwarm'</span><span class="s2">, </span><span class="s1">center</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">fmt</span><span class="s2">=</span><span class="s4">&quot;.2f&quot;</span><span class="s2">, </span><span class="s1">linewidths</span><span class="s2">=</span><span class="s6">.5</span><span class="s2">)</span>
                            <span class="s1">plt</span><span class="s2">.</span><span class="s1">title</span><span class="s2">(</span><span class="s4">'Correlation Between Balance Parameters and Cognitive Dissonance'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s6">16</span><span class="s2">)</span>
                            <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>
                            <span class="s1">plt</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">output_dir</span><span class="s2">, </span><span class="s4">'correlation_heatmap.png'</span><span class="s2">), </span><span class="s1">dpi</span><span class="s2">=</span><span class="s6">300</span><span class="s2">)</span>
                            <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>
                        <span class="s0">else</span><span class="s2">:</span>
                            <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;Skipping correlation heatmap: insufficient data.&quot;</span><span class="s2">)</span>
                    <span class="s0">except </span><span class="s1">Exception </span><span class="s0">as </span><span class="s1">e</span><span class="s2">:</span>
                        <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Error creating correlation heatmap: </span><span class="s0">{</span><span class="s1">e</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

                    <span class="s3"># 2. Paired T-Test Bar Plots</span>
                    <span class="s0">try</span><span class="s2">:</span>
                        <span class="s1">ttest_df </span><span class="s2">= </span><span class="s1">results</span><span class="s2">[</span><span class="s4">'ttest'</span><span class="s2">]</span>
                        <span class="s0">for </span><span class="s1">test_type </span><span class="s0">in </span><span class="s2">[</span><span class="s4">'ITUG'</span><span class="s2">, </span><span class="s4">'ISWAY'</span><span class="s2">]:</span>
                            <span class="s1">df_subset </span><span class="s2">= </span><span class="s1">ttest_df</span><span class="s2">[</span><span class="s1">ttest_df</span><span class="s2">[</span><span class="s4">'test_type'</span><span class="s2">] == </span><span class="s1">test_type</span><span class="s2">]</span>
                            <span class="s0">if not </span><span class="s1">df_subset</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">:</span>
                                <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">12</span><span class="s2">, </span><span class="s6">7</span><span class="s2">))</span>
                                <span class="s1">bars </span><span class="s2">= </span><span class="s1">sns</span><span class="s2">.</span><span class="s1">barplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=</span><span class="s4">'parameter'</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s4">'t_statistic'</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">df_subset</span><span class="s2">,</span>
                                                   <span class="s1">palette</span><span class="s2">=[</span><span class="s4">'green' </span><span class="s0">if </span><span class="s1">sig </span><span class="s0">else </span><span class="s4">'gray' </span><span class="s0">for </span><span class="s1">sig </span><span class="s0">in</span>
                                                            <span class="s1">df_subset</span><span class="s2">[</span><span class="s4">'significant'</span><span class="s2">]])</span>

                                <span class="s3"># Add p-values above bars</span>
                                <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">p </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">df_subset</span><span class="s2">[</span><span class="s4">'p_value'</span><span class="s2">]):</span>
                                    <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s1">i</span><span class="s2">, </span><span class="s1">df_subset</span><span class="s2">[</span><span class="s4">'t_statistic'</span><span class="s2">].</span><span class="s1">iloc</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] + (</span>
                                        <span class="s6">0.1 </span><span class="s0">if </span><span class="s1">df_subset</span><span class="s2">[</span><span class="s4">'t_statistic'</span><span class="s2">].</span><span class="s1">iloc</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] &gt;= </span><span class="s6">0 </span><span class="s0">else </span><span class="s2">-</span><span class="s6">0.3</span><span class="s2">),</span>
                                             <span class="s4">f'p=</span><span class="s0">{</span><span class="s1">p</span><span class="s0">:</span><span class="s4">.3f</span><span class="s0">}</span><span class="s4">'</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s4">'center'</span><span class="s2">)</span>

                                <span class="s1">plt</span><span class="s2">.</span><span class="s1">title</span><span class="s2">(</span><span class="s4">f'</span><span class="s0">{</span><span class="s1">test_type</span><span class="s0">} </span><span class="s4">Parameters: Pre vs Post Paired T-Test Results'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s6">16</span><span class="s2">)</span>
                                <span class="s1">plt</span><span class="s2">.</span><span class="s1">xticks</span><span class="s2">(</span><span class="s1">rotation</span><span class="s2">=</span><span class="s6">45</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s4">'right'</span><span class="s2">)</span>
                                <span class="s1">plt</span><span class="s2">.</span><span class="s1">axhline</span><span class="s2">(</span><span class="s1">y</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'k'</span><span class="s2">, </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s4">'-'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s6">0.3</span><span class="s2">)</span>
                                <span class="s1">plt</span><span class="s2">.</span><span class="s1">ylabel</span><span class="s2">(</span><span class="s4">'T-Statistic'</span><span class="s2">)</span>
                                <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>
                                <span class="s1">plt</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">output_dir</span><span class="s2">, </span><span class="s4">f'</span><span class="s0">{</span><span class="s1">test_type</span><span class="s0">}</span><span class="s4">_ttest_barplot.png'</span><span class="s2">), </span><span class="s1">dpi</span><span class="s2">=</span><span class="s6">300</span><span class="s2">)</span>
                                <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>
                        <span class="s0">else</span><span class="s2">:</span>
                            <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Skipping </span><span class="s0">{</span><span class="s1">test_type</span><span class="s0">} </span><span class="s4">t-test plot: insufficient data.&quot;</span><span class="s2">)</span>
                    <span class="s0">except </span><span class="s1">Exception </span><span class="s0">as </span><span class="s1">e</span><span class="s2">:</span>
                        <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Error creating t-test bar plots: </span><span class="s0">{</span><span class="s1">e</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

                    <span class="s3"># 3. Mixed Effects Model Forest Plot</span>
                    <span class="s0">try</span><span class="s2">:</span>
                        <span class="s1">mixed_df </span><span class="s2">= </span><span class="s1">results</span><span class="s2">[</span><span class="s4">'mixed_effects'</span><span class="s2">]</span>
                        <span class="s0">if not </span><span class="s1">mixed_df</span><span class="s2">.</span><span class="s1">empty </span><span class="s0">and not </span><span class="s1">mixed_df</span><span class="s2">[</span><span class="s4">'coefficient'</span><span class="s2">].</span><span class="s1">isna</span><span class="s2">().</span><span class="s1">all</span><span class="s2">():</span>
                            <span class="s3"># Create separate plots for each model type</span>
                            <span class="s0">for </span><span class="s1">model_type </span><span class="s0">in </span><span class="s1">mixed_df</span><span class="s2">[</span><span class="s4">'model_type'</span><span class="s2">].</span><span class="s1">unique</span><span class="s2">():</span>
                                <span class="s1">model_data </span><span class="s2">= </span><span class="s1">mixed_df</span><span class="s2">[</span><span class="s1">mixed_df</span><span class="s2">[</span><span class="s4">'model_type'</span><span class="s2">] == </span><span class="s1">model_type</span><span class="s2">].</span><span class="s1">copy</span><span class="s2">()</span>
                                <span class="s0">if not </span><span class="s1">model_data</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">:</span>
                                    <span class="s1">model_data</span><span class="s2">[</span><span class="s4">'label'</span><span class="s2">] = </span><span class="s1">model_data</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span>
                                        <span class="s0">lambda </span><span class="s1">row</span><span class="s2">: </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">row</span><span class="s2">[</span><span class="s4">'test_type'</span><span class="s2">]</span><span class="s0">} {</span><span class="s1">row</span><span class="s2">[</span><span class="s4">'parameter'</span><span class="s2">]</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s6">1</span><span class="s2">)</span>

                                    <span class="s3"># Sort by coefficient value</span>
                                    <span class="s1">model_data </span><span class="s2">= </span><span class="s1">model_data</span><span class="s2">.</span><span class="s1">sort_values</span><span class="s2">(</span><span class="s4">'coefficient'</span><span class="s2">)</span>

                                    <span class="s3"># Determine y-position for each row</span>
                                    <span class="s1">y_pos </span><span class="s2">= </span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">model_data</span><span class="s2">))</span>

                                    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">10</span><span class="s2">, </span><span class="s1">max</span><span class="s2">(</span><span class="s6">6</span><span class="s2">, </span><span class="s1">len</span><span class="s2">(</span><span class="s1">model_data</span><span class="s2">) * </span><span class="s6">0.4</span><span class="s2">)))</span>

                                    <span class="s3"># Plot coefficients and confidence intervals</span>
                                    <span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">model_data</span><span class="s2">[</span><span class="s4">'coefficient'</span><span class="s2">], </span><span class="s1">y_pos</span><span class="s2">, </span><span class="s1">s</span><span class="s2">=</span><span class="s6">80</span><span class="s2">,</span>
                                                <span class="s1">c</span><span class="s2">=[</span><span class="s4">'green' </span><span class="s0">if </span><span class="s1">p </span><span class="s2">&lt; </span><span class="s6">0.05 </span><span class="s0">else </span><span class="s4">'gray' </span><span class="s0">for </span><span class="s1">p </span><span class="s0">in </span><span class="s1">model_data</span><span class="s2">[</span><span class="s4">'p_value'</span><span class="s2">]])</span>

                                    <span class="s3"># Add vertical line at zero</span>
                                    <span class="s1">plt</span><span class="s2">.</span><span class="s1">axvline</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'k'</span><span class="s2">, </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s4">'--'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s6">0.7</span><span class="s2">)</span>

                                    <span class="s3"># Add labels and title</span>
                                    <span class="s1">plt</span><span class="s2">.</span><span class="s1">yticks</span><span class="s2">(</span><span class="s1">y_pos</span><span class="s2">, </span><span class="s1">model_data</span><span class="s2">[</span><span class="s4">'label'</span><span class="s2">])</span>

                                    <span class="s1">model_type_labels </span><span class="s2">= {</span>
                                        <span class="s4">'pre_balance_on_cd'</span><span class="s2">: </span><span class="s4">'Effect of Initial Balance on Cognitive Dissonance'</span><span class="s2">,</span>
                                        <span class="s4">'cd_on_post_balance'</span><span class="s2">: </span><span class="s4">'Effect of Cognitive Dissonance on Final Balance'</span><span class="s2">,</span>
                                        <span class="s4">'rejected_diff_on_post_balance'</span><span class="s2">: </span><span class="s4">'Effect of Rejected Rating Difference on Final Balance'</span>
                                    <span class="s2">}</span>

                                    <span class="s1">plt</span><span class="s2">.</span><span class="s1">title</span><span class="s2">(</span><span class="s1">model_type_labels</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">model_type</span><span class="s2">, </span><span class="s1">model_type</span><span class="s2">), </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s6">16</span><span class="s2">)</span>
                                    <span class="s1">plt</span><span class="s2">.</span><span class="s1">xlabel</span><span class="s2">(</span><span class="s4">'Coefficient (Effect Size)'</span><span class="s2">)</span>
                                    <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>
                                    <span class="s1">plt</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s4">'x'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s6">0.3</span><span class="s2">)</span>
                                    <span class="s1">plt</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">output_dir</span><span class="s2">, </span><span class="s4">f'mixed_effects_</span><span class="s0">{</span><span class="s1">model_type</span><span class="s0">}</span><span class="s4">_plot.png'</span><span class="s2">),</span>
                                                <span class="s1">dpi</span><span class="s2">=</span><span class="s6">300</span><span class="s2">)</span>
                                    <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>
                        <span class="s0">else</span><span class="s2">:</span>
                            <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;Skipping mixed effects forest plot: insufficient data.&quot;</span><span class="s2">)</span>
                    <span class="s0">except </span><span class="s1">Exception </span><span class="s0">as </span><span class="s1">e</span><span class="s2">:</span>
                        <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Error creating mixed effects forest plot: </span><span class="s0">{</span><span class="s1">e</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

                    <span class="s3"># 4. Change Score Correlation Plot</span>
                    <span class="s0">try</span><span class="s2">:</span>
                        <span class="s1">change_df </span><span class="s2">= </span><span class="s1">results</span><span class="s2">[</span><span class="s4">'change_score'</span><span class="s2">]</span>
                        <span class="s0">if not </span><span class="s1">change_df</span><span class="s2">.</span><span class="s1">empty </span><span class="s0">and not </span><span class="s1">change_df</span><span class="s2">[</span><span class="s4">'correlation'</span><span class="s2">].</span><span class="s1">isna</span><span class="s2">().</span><span class="s1">all</span><span class="s2">():</span>
                            <span class="s1">significant_changes </span><span class="s2">= </span><span class="s1">change_df</span><span class="s2">[</span><span class="s1">change_df</span><span class="s2">[</span><span class="s4">'significant'</span><span class="s2">] == </span><span class="s0">True</span><span class="s2">]</span>
                            <span class="s0">if not </span><span class="s1">significant_changes</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">:</span>
                                <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">12</span><span class="s2">, </span><span class="s6">8</span><span class="s2">))</span>
                                <span class="s1">bars </span><span class="s2">= </span><span class="s1">sns</span><span class="s2">.</span><span class="s1">barplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=</span><span class="s4">'parameter'</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s4">'correlation'</span><span class="s2">, </span><span class="s1">hue</span><span class="s2">=</span><span class="s4">'test_type'</span><span class="s2">,</span>
                                                   <span class="s1">data</span><span class="s2">=</span><span class="s1">significant_changes</span><span class="s2">)</span>

                                <span class="s3"># Add significance markers</span>
                                <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">p </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">significant_changes</span><span class="s2">[</span><span class="s4">'p_value'</span><span class="s2">]):</span>
                                    <span class="s1">marker </span><span class="s2">= </span><span class="s4">'***' </span><span class="s0">if </span><span class="s1">p </span><span class="s2">&lt; </span><span class="s6">0.001 </span><span class="s0">else </span><span class="s4">'**' </span><span class="s0">if </span><span class="s1">p </span><span class="s2">&lt; </span><span class="s6">0.01 </span><span class="s0">else </span><span class="s4">'*' </span><span class="s0">if </span><span class="s1">p </span><span class="s2">&lt; </span><span class="s6">0.05 </span><span class="s0">else </span><span class="s4">''</span>
                                    <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s1">i</span><span class="s2">, </span><span class="s1">significant_changes</span><span class="s2">[</span><span class="s4">'correlation'</span><span class="s2">].</span><span class="s1">iloc</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] +</span>
                                             <span class="s2">(</span><span class="s6">0.05 </span><span class="s0">if </span><span class="s1">significant_changes</span><span class="s2">[</span><span class="s4">'correlation'</span><span class="s2">].</span><span class="s1">iloc</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] &gt;= </span><span class="s6">0 </span><span class="s0">else </span><span class="s2">-</span><span class="s6">0.1</span><span class="s2">),</span>
                                             <span class="s1">marker</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s4">'center'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s6">14</span><span class="s2">)</span>

                                <span class="s1">plt</span><span class="s2">.</span><span class="s1">title</span><span class="s2">(</span><span class="s4">'Significant Correlations Between Balance Changes and Cognitive Dissonance'</span><span class="s2">,</span>
                                          <span class="s1">fontsize</span><span class="s2">=</span><span class="s6">16</span><span class="s2">)</span>
                                <span class="s1">plt</span><span class="s2">.</span><span class="s1">xticks</span><span class="s2">(</span><span class="s1">rotation</span><span class="s2">=</span><span class="s6">45</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s4">'right'</span><span class="s2">)</span>
                                <span class="s1">plt</span><span class="s2">.</span><span class="s1">axhline</span><span class="s2">(</span><span class="s1">y</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'k'</span><span class="s2">, </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s4">'-'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s6">0.3</span><span class="s2">)</span>
                                <span class="s1">plt</span><span class="s2">.</span><span class="s1">ylabel</span><span class="s2">(</span><span class="s4">'Correlation Coefficient'</span><span class="s2">)</span>
                                <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>
                                <span class="s1">plt</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">output_dir</span><span class="s2">, </span><span class="s4">'significant_change_correlations.png'</span><span class="s2">), </span><span class="s1">dpi</span><span class="s2">=</span><span class="s6">300</span><span class="s2">)</span>
                                <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>
                            <span class="s0">else</span><span class="s2">:</span>
                                <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;Skipping change score correlation plot: no significant correlations.&quot;</span><span class="s2">)</span>
                        <span class="s0">else</span><span class="s2">:</span>
                            <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;Skipping change score correlation plot: insufficient data.&quot;</span><span class="s2">)</span>
                    <span class="s0">except </span><span class="s1">Exception </span><span class="s0">as </span><span class="s1">e</span><span class="s2">:</span>
                        <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Error creating change score correlation plot: </span><span class="s0">{</span><span class="s1">e</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

                    <span class="s3"># 5. Demographics visualization</span>
                    <span class="s0">try</span><span class="s2">:</span>
                        <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;Creating demographic visualizations...&quot;</span><span class="s2">)</span>
                        <span class="s1">demographics </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">({</span>
                            <span class="s4">'Gender'</span><span class="s2">: </span><span class="s1">results</span><span class="s2">[</span><span class="s4">'demographics'</span><span class="s2">][</span><span class="s4">'gender'</span><span class="s2">],</span>
                            <span class="s4">'Age'</span><span class="s2">: </span><span class="s1">results</span><span class="s2">[</span><span class="s4">'demographics'</span><span class="s2">][</span><span class="s4">'age'</span><span class="s2">],</span>
                            <span class="s4">'BMI'</span><span class="s2">: </span><span class="s1">results</span><span class="s2">[</span><span class="s4">'demographics'</span><span class="s2">][</span><span class="s4">'bmi'</span><span class="s2">]</span>
                        <span class="s2">})</span>

                        <span class="s3"># Gender distribution</span>
                        <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">8</span><span class="s2">, </span><span class="s6">6</span><span class="s2">))</span>
                        <span class="s1">gender_counts </span><span class="s2">= </span><span class="s1">demographics</span><span class="s2">[</span><span class="s4">'Gender'</span><span class="s2">].</span><span class="s1">value_counts</span><span class="s2">()</span>
                        <span class="s1">plt</span><span class="s2">.</span><span class="s1">pie</span><span class="s2">(</span><span class="s1">gender_counts</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">gender_counts</span><span class="s2">.</span><span class="s1">index</span><span class="s2">, </span><span class="s1">autopct</span><span class="s2">=</span><span class="s4">'%1.1f%%'</span><span class="s2">, </span><span class="s1">startangle</span><span class="s2">=</span><span class="s6">90</span><span class="s2">,</span>
                                <span class="s1">colors</span><span class="s2">=[</span><span class="s4">'skyblue'</span><span class="s2">, </span><span class="s4">'lightpink'</span><span class="s2">])</span>
                        <span class="s1">plt</span><span class="s2">.</span><span class="s1">title</span><span class="s2">(</span><span class="s4">'Gender Distribution'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s6">16</span><span class="s2">)</span>
                        <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>
                        <span class="s1">plt</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">output_dir</span><span class="s2">, </span><span class="s4">'gender_distribution.png'</span><span class="s2">), </span><span class="s1">dpi</span><span class="s2">=</span><span class="s6">300</span><span class="s2">)</span>
                        <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>

                        <span class="s3"># Age distribution</span>
                        <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">10</span><span class="s2">, </span><span class="s6">6</span><span class="s2">))</span>
                        <span class="s1">sns</span><span class="s2">.</span><span class="s1">histplot</span><span class="s2">(</span><span class="s1">demographics</span><span class="s2">[</span><span class="s4">'Age'</span><span class="s2">], </span><span class="s1">kde</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">bins</span><span class="s2">=</span><span class="s6">10</span><span class="s2">)</span>
                        <span class="s1">plt</span><span class="s2">.</span><span class="s1">title</span><span class="s2">(</span><span class="s4">'Age Distribution'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s6">16</span><span class="s2">)</span>
                        <span class="s1">plt</span><span class="s2">.</span><span class="s1">xlabel</span><span class="s2">(</span><span class="s4">'Age (years)'</span><span class="s2">)</span>
                        <span class="s1">plt</span><span class="s2">.</span><span class="s1">ylabel</span><span class="s2">(</span><span class="s4">'Count'</span><span class="s2">)</span>
                        <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>
                        <span class="s1">plt</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">output_dir</span><span class="s2">, </span><span class="s4">'age_distribution.png'</span><span class="s2">), </span><span class="s1">dpi</span><span class="s2">=</span><span class="s6">300</span><span class="s2">)</span>
                        <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>

                        <span class="s3"># BMI distribution</span>
                        <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">10</span><span class="s2">, </span><span class="s6">6</span><span class="s2">))</span>
                        <span class="s1">sns</span><span class="s2">.</span><span class="s1">histplot</span><span class="s2">(</span><span class="s1">demographics</span><span class="s2">[</span><span class="s4">'BMI'</span><span class="s2">], </span><span class="s1">kde</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">bins</span><span class="s2">=</span><span class="s6">10</span><span class="s2">)</span>
                        <span class="s1">plt</span><span class="s2">.</span><span class="s1">title</span><span class="s2">(</span><span class="s4">'BMI Distribution'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s6">16</span><span class="s2">)</span>
                        <span class="s1">plt</span><span class="s2">.</span><span class="s1">xlabel</span><span class="s2">(</span><span class="s4">'BMI (kg/m)'</span><span class="s2">)</span>
                        <span class="s1">plt</span><span class="s2">.</span><span class="s1">ylabel</span><span class="s2">(</span><span class="s4">'Count'</span><span class="s2">)</span>

                        <span class="s3"># Add BMI category lines</span>
                        <span class="s1">plt</span><span class="s2">.</span><span class="s1">axvline</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=</span><span class="s6">18.5</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s4">'--'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s6">0.7</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">'Underweight &lt; 18.5'</span><span class="s2">)</span>
                        <span class="s1">plt</span><span class="s2">.</span><span class="s1">axvline</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=</span><span class="s6">25</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'g'</span><span class="s2">, </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s4">'--'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s6">0.7</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">'Normal 18.5-24.9'</span><span class="s2">)</span>
                        <span class="s1">plt</span><span class="s2">.</span><span class="s1">axvline</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=</span><span class="s6">30</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'b'</span><span class="s2">, </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s4">'--'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s6">0.7</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">'Overweight 25-29.9'</span><span class="s2">)</span>
                        <span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
                        <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>
                        <span class="s1">plt</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">output_dir</span><span class="s2">, </span><span class="s4">'bmi_distribution.png'</span><span class="s2">), </span><span class="s1">dpi</span><span class="s2">=</span><span class="s6">300</span><span class="s2">)</span>
                        <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>

                    <span class="s0">except </span><span class="s1">Exception </span><span class="s0">as </span><span class="s1">e</span><span class="s2">:</span>
                        <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Error creating demographic visualizations: </span><span class="s0">{</span><span class="s1">e</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

                <span class="s0">def </span><span class="s1">main</span><span class="s2">():</span>
                    <span class="s5">&quot;&quot;&quot; 
                    Main function to run the analysis 
                    &quot;&quot;&quot;</span>
                    <span class="s3"># Define parameters</span>
                    <span class="s1">base_dir </span><span class="s2">= </span><span class="s4">&quot;analysis_results&quot;</span>
                    <span class="s1">output_dir </span><span class="s2">= </span><span class="s4">&quot;analysis_results/output&quot;</span>
                    <span class="s1">os</span><span class="s2">.</span><span class="s1">makedirs</span><span class="s2">(</span><span class="s1">output_dir</span><span class="s2">, </span><span class="s1">exist_ok</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

                    <span class="s3"># Load and preprocess data</span>
                    <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;Loading and preprocessing data...&quot;</span><span class="s2">)</span>
                    <span class="s1">df </span><span class="s2">= </span><span class="s1">load_data</span><span class="s2">(</span><span class="s1">base_dir</span><span class="s2">)</span>

                    <span class="s0">if </span><span class="s1">df</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">:</span>
                        <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;No valid data found. Exiting.&quot;</span><span class="s2">)</span>
                        <span class="s0">return</span>

                    <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Loaded data for </span><span class="s0">{</span><span class="s1">len</span><span class="s2">(</span><span class="s1">df</span><span class="s2">)</span><span class="s0">} </span><span class="s4">participants&quot;</span><span class="s2">)</span>

                    <span class="s3"># Calculate balance changes</span>
                    <span class="s1">balance_changes </span><span class="s2">= </span><span class="s1">calculate_balance_changes</span><span class="s2">(</span><span class="s1">df</span><span class="s2">)</span>

                    <span class="s3"># Run analyses</span>
                    <span class="s1">results </span><span class="s2">= {</span>
                        <span class="s4">'demographics'</span><span class="s2">: {</span>
                            <span class="s4">'gender'</span><span class="s2">: </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'gender'</span><span class="s2">],</span>
                            <span class="s4">'age'</span><span class="s2">: </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'age'</span><span class="s2">],</span>
                            <span class="s4">'bmi'</span><span class="s2">: </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'bmi'</span><span class="s2">]</span>
                        <span class="s2">},</span>
                        <span class="s4">'correlations'</span><span class="s2">: </span><span class="s1">correlation_analysis</span><span class="s2">(</span><span class="s1">df</span><span class="s2">),</span>
                        <span class="s4">'regression'</span><span class="s2">: </span><span class="s1">linear_regression_analysis</span><span class="s2">(</span><span class="s1">df</span><span class="s2">),</span>
                        <span class="s4">'anova'</span><span class="s2">: </span><span class="s1">anova_analysis</span><span class="s2">(</span><span class="s1">df</span><span class="s2">),</span>
                        <span class="s4">'ttest'</span><span class="s2">: </span><span class="s1">paired_ttest_analysis</span><span class="s2">(</span><span class="s1">df</span><span class="s2">),</span>
                        <span class="s4">'change_score'</span><span class="s2">: </span><span class="s1">change_score_analysis</span><span class="s2">(</span><span class="s1">balance_changes</span><span class="s2">, </span><span class="s1">df</span><span class="s2">),</span>
                        <span class="s4">'mixed_effects'</span><span class="s2">: </span><span class="s1">mixed_effects_model</span><span class="s2">(</span><span class="s1">df</span><span class="s2">)</span>
                    <span class="s2">}</span>

                    <span class="s3"># Create visualizations</span>
                    <span class="s1">create_visualizations</span><span class="s2">(</span><span class="s1">results</span><span class="s2">, </span><span class="s1">output_dir</span><span class="s2">)</span>

                    <span class="s3"># Save results to CSV</span>
                    <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">Saving results to CSV files...&quot;</span><span class="s2">)</span>
                    <span class="s0">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">result_df </span><span class="s0">in </span><span class="s1">results</span><span class="s2">.</span><span class="s1">items</span><span class="s2">():</span>
                        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">result_df</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">):</span>
                            <span class="s1">result_df</span><span class="s2">.</span><span class="s1">to_csv</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">output_dir</span><span class="s2">, </span><span class="s4">f'</span><span class="s0">{</span><span class="s1">key</span><span class="s0">}</span><span class="s4">_results.csv'</span><span class="s2">), </span><span class="s1">index</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
                            <span class="s1">print</span><span class="s2">(</span><span class="s4">f&quot;Saved </span><span class="s0">{</span><span class="s1">key</span><span class="s0">}</span><span class="s4">_results.csv&quot;</span><span class="s2">)</span>

                    <span class="s3"># Save participant data</span>
                    <span class="s1">df</span><span class="s2">.</span><span class="s1">to_csv</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">output_dir</span><span class="s2">, </span><span class="s4">'participant_data.csv'</span><span class="s2">), </span><span class="s1">index</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
                    <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;Saved participant_data.csv&quot;</span><span class="s2">)</span>

                    <span class="s1">print</span><span class="s2">(</span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">Analysis complete. Results saved in&quot;</span><span class="s2">, </span><span class="s1">output_dir</span><span class="s2">)</span>

                <span class="s0">if </span><span class="s1">__name__ </span><span class="s2">== </span><span class="s4">&quot;__main__&quot;</span><span class="s2">:</span>
                    <span class="s1">main</span><span class="s2">()</span></pre>
</body>
</html>